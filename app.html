<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FLYMILY — לוח טיולים</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="firebase.js"></script>
  <script>
    const appUrl = new URL('./app/index.html', location.href).href;
    window.addEventListener('DOMContentLoaded', () => { try { location.replace(appUrl); } catch(e) { location.href = appUrl; } });
  </script>
</head>
<body class="page">
  <header class="topbar">
    <div class="user" id="userBadge"></div>
    <button id="logoutBtn" class="btn danger">התנתקות</button>
  </header>

  <main class="card">
    <h1 class="title"><span>FLYMILY</span> — לוח טיולים</h1>
    <p class="lead">מעביר אותך לעמוד האפליקציה…</p>
    <p class="muted">אם ההפניה לא בוצעה, <a id="appLink" href="./app/index.html">לחץ כאן</a>.</p>
  </main>

  <script type="module">
    import { api } from './firebase.js';
    import { onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js';
    const userBadge = document.getElementById('userBadge');
    const logoutBtn = document.getElementById('logoutBtn');
    const appLink = document.getElementById('appLink');
    appLink.href = new URL('./app/index.html', location.href).href;

    onAuthStateChanged(api.auth, (user)=>{
      userBadge.textContent = user ? (user.email || 'מחובר/ת') : 'אורח/ת';
    });
    logoutBtn.addEventListener('click', async ()=>{
      try { await signOut(api.auth); } finally { location.href = './'; }
    });
  </script>
</body>
</html>

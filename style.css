:root{
  --bg:#0f1115; --card:#151922; --ink:#e9eef4; --muted:#9fb0c0; --brand:#8bd3ff; --accent:#ffd166; --ok:#06d6a0; --danger:#ef476f;
  --border:#273142; --shadow:0 10px 30px rgba(0,0,0,.25);
  --glass: color-mix(in oklab, var(--card) 78%, transparent);
}
[data-theme="light"]{
  --bg:#f6f7fb; --card:#ffffff; --ink:#0e1116; --muted:#415266; --brand:#1a73ff; --accent:#faad14; --ok:#089e71; --danger:#d9363e; --border:#e6e9ef; --shadow:0 16px 30px rgba(16,24,40,.08);
  --glass: color-mix(in oklab, #ffffff 70%, transparent);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:Rubik,system-ui,-apple-system,Segoe UI,Roboto,Arial;overflow:hidden;direction:rtl}
/* Radical refresh: soft gradient canvas (does not change logic) */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:
    radial-gradient(900px 500px at 10% 0%, color-mix(in oklab, var(--brand) 22%, transparent), transparent 60%),
    radial-gradient(700px 420px at 90% 10%, color-mix(in oklab, var(--accent) 18%, transparent), transparent 55%),
    radial-gradient(900px 520px at 50% 110%, color-mix(in oklab, var(--ok) 14%, transparent), transparent 60%);
  pointer-events:none;
  z-index:-1;
  opacity:.9;
}
a{color:var(--brand);text-decoration:none}
.app{display:grid;grid-template-rows:auto 1fr;height:100%;width:100%}header{display:flex;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid var(--border);background:var(--card);position:sticky;top:0;z-index:5     flex-direction: row; }
header .brand{font-weight:700;letter-spacing:.5px}
header .spacer{flex:1}
header button, .btn{background:transparent;border:1px solid var(--border);color:var(--ink);padding:8px 12px;border-radius:12px;cursor:pointer}
.btn.primary{border-color:var(--brand);background:color-mix(in oklab, var(--brand) 20%, transparent)}
.btn.danger{border-color:var(--danger);color:var(--danger)}
.btn:disabled{opacity:.5;cursor:not-allowed}

/* New "glass" chrome */
header{
  background: var(--glass);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  box-shadow: 0 14px 30px rgba(0,0,0,.08);
  flex-direction: row;
}
/* Keep the general UI crisp (avoid over-rounded pills) */
header button, .btn{border-radius:12px}

.container{display:grid;grid-template-columns:320px 1fr;height:100%;min-height:0;overflow:hidden}
.sidebar{border-inline-start:1px solid var(--border);background:var(--card);padding:16px;overflow:auto}
.content{display:flex;flex-direction:column;padding:0;overflow:hidden}

.section-title{display:flex;align-items:center;gap:10px;margin:8px 0 12px}
.input, select, textarea{width:100%;background:transparent;border:1px solid var(--border);color:var(--ink);padding:10px 12px;border-radius:10px;outline:none}
textarea{min-height:80px}
.row{display:flex;gap:10px}
.row > *{flex:1}

.list-actions{display:flex;gap:8px;align-items:center;padding: 12px 0;}

/* Overview: floating command bar */
.overview-actions{
  position: sticky;
  top: 12px;
  z-index: 30;
  padding: 10px;
  margin-bottom: 12px;
  background: var(--glass);
  border: 1px solid var(--border);
  border-radius: 20px;
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  box-shadow: 0 18px 38px rgba(0,0,0,.10);
}

/* Optional dock zone ("attached" to the import/share area): places the same bar above all tabs */
.top-dock{
  padding: 0 16px;
  flex-shrink: 0;
}
.top-dock .overview-actions{
  margin: 6px 0 12px;
}
.overview-actions.is-docked{
  border-color: color-mix(in oklab, var(--brand) 45%, var(--border));
}
.overview-actions.is-docked::before{
  content: "כלי חיפוש / מיון (הצג הכל)";
  display: block;
  font-size: 12px;
  color: var(--muted);
  margin: 0 4px 8px;
}
.overview-actions-top{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.overview-actions .hits{min-width:64px;text-align:center}
.overview-quick{display:flex;gap:8px;align-items:center;flex-wrap:nowrap;margin-inline-start:auto}
.overview-actions .search-input{flex:0 1 170px;min-width:160px;max-width:240px}
.overview-actions .budget-bar{width:100%;margin-top:10px}
/* Tabs: professional segmented bar (no giant ellipses) */
.tabs{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 16px;
  flex-shrink:0;
  z-index:4;
  min-height:54px; /* keep consistent top-bar height */
}

/* Overview tab as dropdown */
.tab-select-wrap{display:inline-flex;align-items:center;position:relative;}
.tab-select{
  appearance:none;
  -webkit-appearance:none;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 10px 38px 10px 14px;
  font-weight: 800;
  cursor: pointer;
  line-height: 1;
  height: 46px;
}
.tab-select-wrap::after{
  content: "▾";
  position:absolute;
  left: 14px;
  top:50%;
  transform: translateY(-50%);
  color: var(--muted);
  pointer-events:none;
}
.tab-select-wrap.active .tab-select{
  background: var(--brand);
  border-color: color-mix(in oklab, var(--brand) 80%, var(--border));
  color: #fff;
}
.tabs button{
  padding:9px 12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:color-mix(in oklab, var(--card) 88%, transparent);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  font-weight:600;
  line-height:1;
  height:38px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
.tabs button.active{
  background: var(--brand);
  border-color: color-mix(in oklab, var(--brand) 80%, var(--border));
  color: white;
  outline:none;
}
/* Overview command bar docked next to the Share tab (not floating) */
/* Overview tools row (shown only when "הצג הכל" active) */
.overview-headerbar{
  display:flex;
  align-items:center;
  gap:10px;
  margin-inline-start:12px;
  padding:6px 10px;
  border:1px solid var(--border);
  border-radius:14px;
  background: color-mix(in oklab, var(--card) 82%, transparent);
  box-shadow: 0 10px 24px rgba(0,0,0,.06);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  flex:1 1 auto;
  min-width:320px;
  min-height:54px; /* align with .tabs */
}
.overview-headerbar .btn{
  padding:8px 10px;
  border-radius:10px;
  height:38px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
.overview-headerbar .nav-btn,
.overview-headerbar .sort-icon-btn{
  inline-size:38px;
  block-size:38px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:0;
}
.overview-headerbar .hits{min-width:70px;text-align:center;font-weight:600;color:var(--muted)}
.overview-headerbar .search-input{height:38px;border-radius:10px}
.overview-headerbar .overview-quick .btn.primary{background: color-mix(in oklab, var(--ok) 22%, transparent); border-color: color-mix(in oklab, var(--ok) 55%, var(--border));}
.overview-headerbar .search-input{
  /* slightly shorter (~30%) so the toolbar is more compact */
  flex:0 1 155px;
  min-width:140px;
  max-width:220px;
}

.overview-headerbar .mode-select{
  height:38px;
  border-radius:10px;
  padding:0 10px;
  flex:0 0 140px;
  max-width:160px;
}
.overview-headerbar .overview-quick{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:nowrap;
}
@media (max-width: 900px){
  .overview-headerbar{
    flex-wrap:wrap;
    border-radius:22px;
  }
}


.trip-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
.list{display:flex;flex-direction:column;gap:8px}
.trip-row{
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: 10px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: var(--card);
}
.trip-row > div:first-child {
  display: flex;
  flex-direction: column;
}
.trip-row .pill {
  width: fit-content;
  margin-top: 4px;
}
.muted{color:var(--muted)}
.pill{border:1px solid var(--border);padding:4px 8px;border-radius:999px;font-size:.85rem}

.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:12px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
table{width:100%;border-collapse:separate;border-spacing:0}
th,td{border-bottom:1px solid var(--border);padding:10px;text-align:right}
th{position:sticky;top:0;background:var(--card)}

.menu{position:relative}
.menu-btn{border:1px solid var(--border);background:transparent;border-radius:10px;padding:6px 10px}
.menu-list{position:absolute;left:0;top:36px;background:var(--card);border:1px solid var(--border);border-radius:12px;min-width:160px;display:none;z-index: 2000}
.menu-list.open{display:block}
.menu-list button{display:block;width:100%;padding:10px;background:transparent;border:none;text-align:right}

.leaflet-container{height:420px;border-radius:16px;border:1px solid var(--border)}
.map-toolbar{position:absolute;left:64px;top:12px;display:flex;gap:10px;z-index:1200;pointer-events:auto}

dialog.modal{border:1px solid var(--border);border-radius:16px;background:var(--card);color:var(--ink);padding:0;max-width:420px;width:90%}
.modal header{display:flex;align-items:center;gap:10px}

/* Breakdown dialog: wider and more readable (no horizontal scrolling) */
#breakdownDialog.modal{
  width: min(980px, 96vw);
  max-width: min(980px, 96vw);
}
#breakdownDialog .body{
  max-height: calc(90vh - 72px);
  overflow: auto;
}
.modal header{padding:12px 16px;border-bottom:1px solid var(--border);background:transparent}
.modal .body{padding:14px 16px;position:relative}
.modal .footer{display:flex;gap:8px;justify-content:flex-start;padding:12px 16px;border-top:1px solid var(--border)}

.toast{position:fixed;inset-inline-end:16px;inset-block-end:16px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px 14px;box-shadow:var(--shadow);display:none}
.toast.show{display:block}

/* Responsive */
@media (max-width: 900px){
  .container{grid-template-columns:1fr}
  .sidebar{order:2;height:40vh}
  .content{order:1;height:auto}
  body{overflow:auto}
}

/* Modes: home (all trips) vs trip (focus one) */
.container.home-mode{ grid-template-columns: 1fr; }
.container.home-mode .content{ display: none; }
.container.home-mode .sidebar{ display: block; width: 100%; max-width:none; margin:0; }
.container.home-mode .sidebar .section-title h2{ font-size: 1.6rem; }
.container.home-mode #tripList.grid{ grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); }

.container.trip-mode{ grid-template-columns: 1fr; }
.container.trip-mode .sidebar{ display: none; }
/* תיקון לגלילה אנכית בטאבים - מכריח מבנה גמיש שתופס את כל הגובה */
.container.trip-mode .content {
  display: flex !important;
  flex-direction: column !important;
  height: 100% !important;
  overflow: hidden !important;
}

.brand-text{font-weight:700;letter-spacing:.5px}


/* Centered login screen */
.login-screen{display:grid;place-items:center;height:calc(100dvh - 56px);padding:20px}
.login-card{width:min(420px,92vw);background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:20px;display:flex;flex-direction:column;gap:10px;align-items:flex-start}
.login-card h1{font-size:1.6rem;margin:.2rem 0 .4rem}
.login-card .input{width:100%}

/* user badge */
#userBadge{padding:6px 10px;border:1px solid var(--border);border-radius:999px}


/* === Budget Bar === */
.budget-bar{
  display:flex; align-items:center; gap:16px;
  border:1px solid var(--border); border-radius:22px; padding:12px 14px; background:var(--card);
}
.budget-bar .bar-actions{display:flex; gap:10px}
.budget-bar .btn.subtle{border:1px solid var(--border); background:transparent; border-radius:12px; padding:6px 12px}
.budget-bar .bar-cols{display:flex; gap:28px; margin-inline-start:auto}
.budget-bar .col{display:flex; align-items:center; gap:8px; min-width:120px; justify-content:flex-start}
.budget-bar .lbl{color:var(--muted); font-size:14px}
.budget-bar .val{font-size:16px}
.budget-bar .val.bold{font-weight:700}
.budget-bar .val.neg{color:var(--danger)}
.budget-bar .badge{border:1px solid var(--border); border-radius:12px; padding:6px 12px; background:var(--card)}

/* Updated "Meta" tab design */
#view-meta .card {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 16px;
}

#view-meta .card .row.dest-row {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px;
  align-items: end;
}
/* New style for the map button to match the destination input field */
#view-meta .btn.map-btn {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 12px;
  height: 44px; /* Matches the height of the input field */
}


/* New layout for date, people, and trip types */
#view-meta .date-row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  gap: 10px;
  align-items: flex-end;
}
#view-meta .date-row label {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
#view-meta .date-row label:has(#metaStart), #view-meta .date-row label:has(#metaEnd) {
    grid-column: span 1;
    width: 100%;
}
#view-meta .date-row .people-input {
  grid-column: 3 / 4;
}
#view-meta .date-row .multi-types {
  grid-column: 4 / 5;
  display: flex;
  flex-direction: column;
  gap: 4px;
}
#view-meta .date-row .multi-types .lbl {
  font-size: 1em;
}
#view-meta .date-row .chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
#view-meta .date-row .chips .chip {
  padding: 6px 10px;
  flex-shrink: 0;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 999px;
  cursor: pointer;
}
#view-meta .date-row .chips .chip.active {
  background: var(--brand);
  color: var(--ink);
}

/* Budget block */
#view-meta .budget-block {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 12px;
  border: 1px dashed var(--border);
  border-radius: 12px;
}
#view-meta .budget-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
  gap: 8px;
}
#view-meta .budget-actions-row {
  display: flex;
  justify-content: flex-start;
  gap: 10px;
}
#view-meta .rates-line {
  display: none; /* Hide exchange rates section */
}

#view-meta .row:has(#btnSaveMeta) {
  display: flex;
  justify-content: flex-start;
  gap: 8px;
}

/* === shrink budget block height by ~20% === */
#view-meta .budget-block{ padding:9px; gap:6px; }
#view-meta .budget-row{ gap:6px; }
#view-meta .budget-actions-row{ gap:8px; }
#view-meta .budget-block .input{ padding:8px 10px; }


/* === Budget row: shrink inputs to 50% width and keep in one line === */
#view-meta .budget-row{
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr)); /* always one row, 3 columns */
  gap: 10px;
  align-items: end;
}
#view-meta .budget-row .input{
  width: 50% !important; /* half the label width */
}
#view-meta .budget-row label{
  display: flex;
  flex-direction: column;
  align-items: center; /* center the half-width inputs */
}


/* === Budget actions in one line, right-aligned, matching input style === */
#view-meta .budget-actions-row{
  display: flex;
  justify-content: flex-end;   /* push to the right */
  align-items: center;
  gap: 8px;
  margin-top: 6px;
}
#view-meta .budget-actions-row .btn{
  padding: 10px 14px;          /* similar to inputs */
  border-radius: 12px;         /* rounded like inputs */
  line-height: 1.1;
  height: 40px;                /* consistent height */
}


/* === Budget layout: 3 currencies on left, actions on right, same row === */
#view-meta .budget-block{
  display: grid;
  grid-template-columns: repeat(3, minmax(100px, 10%)) 1fr repeat(2, minmax(110px, 12%));
  align-items: end;
  gap: 4px; /* ~10% of typical 40px wider gaps */
  padding: 9px; /* keep the compact padding we set earlier */
}
#view-meta .budget-row,
#view-meta .budget-actions-row{
  display: contents; /* flatten children into grid */
}
#view-meta .budget-row label{
  width: 100%;
  max-width: 140px;   /* keep the inputs compact */
}
#view-meta .budget-row .input{
  width: 100%;
  height: 100%;
  padding: 8px 10px;
}
#view-meta .budget-actions-row .btn{
  width: auto;
  min-width: 120px;
  height: 40px;
  padding: 8px 12px;
  text-align: center;
}

/* Fallback for very narrow screens: stack nicely */
@media (max-width: 720px){
  #view-meta .budget-block{
    grid-template-columns: 1fr 1fr;
  }
  #view-meta .budget-row,
  #view-meta .budget-actions-row{ display: contents; }
}


/* === Meta: emphasize 'יעד' label like 'תקציב' and unify field heights === */
#view-meta .dest-row .dest-col{
  font-weight: 700;
  font-size: 1.5rem; /* similar to h3 heading size */
  line-height: 1.2;
}
/* Remove 'בדוק במפה' button (no meaning) */
#btnVerifyOnMap{ display:none !important; }
/* Unify heights for all inputs in meta section */
#view-meta .input,
#view-meta input[type="date"]{
  height: 44px;
  padding: 10px 12px;
}
/* Keep chips row aligned to same baseline */
#view-meta .chips .chip{ height: 36px; display:flex; align-items:center; }


/* === Overview tab: stack cards vertically === */
#view-overview .cards{
  grid-template-columns: 1fr !important;
  gap: 16px;
}

.rate-note{font-size:12px;opacity:.7;margin-top:2px;direction:rtl}

.rate-line{font-size:12px;margin-top:6px;opacity:.75;direction:rtl}

mark {
  background-color: #ffd166;
  color: var(--ink);
  padding: 2px 4px;
  border-radius: 4px;
}
.match-source {
  font-weight: 700;
}
/* Grid mode */
.grid .trip-card {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 14px;
  border: 1px solid var(--border);
  border-radius: 16px;
  box-shadow: var(--shadow);
}

.grid .trip-card strong {
  font-size: 1.1rem;
}

.grid .trip-card .muted {
  margin-top: 0;
}

.grid .trip-card .pill {
  width: 60%;
  justify-self: start;
}
.trip-card .pill {
  border: 1px solid var(--border);
  padding: 4px 8px;
  border-radius: 999px;
  font-size: .85rem;
}
.grid .trip-card .menu-btn {
  position: absolute;
  top: 50%;
  left: 10px; /* מיקום יחסי לכרטיס */
  transform: translateY(-50%) rotate(90deg); /* יישור למרכז אנכי וסיבוב */
  border: 1px solid var(--border);
  background: transparent;
  border-radius: 10px;
  padding: 6px 10px;
}

/* List mode */
.list .trip-row {
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: 8px;
  padding: 10px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background-color: var(--card);
}

.list .trip-row .pill {
  grid-column: 1;
  width: fit-content;
  margin: 0;
  justify-self: start;
}

.list .trip-row .menu-btn {
  grid-column: 2;
  border: 1px solid var(--border);
  background: transparent;
  border-radius: 10px;
  padding: 6px 10px;
  justify-self: end;
}

.list-actions .btn.active {
  border-color: var(--brand);
  background: color-mix(in oklab, var(--brand) 20%, transparent);
}
.trip-card {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 16px;
  border: 1px solid var(--border);
  border-radius: 16px;
  background-color: var(--card);
  position: relative; /* הוסף מיקום יחסי כדי למקם את הכפתור */
}

.trip-card strong {
  font-size: 1.2rem;
  font-weight: 700;
}

.trip-card .muted {
  font-size: 1rem;
  color: var(--muted);
}
.trip-card > div:first-of-type {
    margin-bottom: 8px;
}

/* New style for the pill to be on the same line as the menu button */
.trip-card .footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.trip-card .menu-btn {
  position: absolute;
  top: 10px;
  left: 10px; /* מיקום בצד שמאל */
  transform: none;
  border: none;
  background: transparent;
  padding: 6px;
}
.trip-card .menu-btn svg {
  transform: rotate(90deg); /* סיבוב כדי שהנקודות יהיו אנכיות */
}

/* New: expense and journal location buttons */
.location-row{
  display:flex;
  gap:8px;
  align-items:center;
}
.location-row label{
    flex-grow:1;
}
.location-row .input{
    width:100%;
}
.location-row .location-btn{
    flex-shrink:0;
    height:44px;
    padding:10px 12px;
    align-self:stretch;
    line-height:22px;
    font-size:14px;
}
.location-row {
  margin-top: 14px;
}

/* New styling for inline links */
.external-link {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.external-link svg {
  width: 14px;
  height: 14px;
  stroke: var(--brand); /* Set icon color to brand color */
}

/* Ensure the link doesn't interfere with the row click */
td a.external-link {
  pointer-events: all;
}

/* Map toolbar buttons */
.map-toolbar .btn{
  background: transparent;
  border: 2px solid var(--border);
  color: var(--ink);
  padding: 8px 14px;
  border-radius: 16px;
  font-weight: 500;
  box-shadow: 0 2px 10px rgba(0,0,0,.10);
}
/* ORIGINAL: #btnToggleSpent{ border-color:#ff8c00; color:#ff8c00; }
#btnToggleSpent.active{ background:#ff8c00; color:#111; border-color:#ff8c00; } */
/* UPDATED to red (#e53935) to match map markers */
#btnToggleSpent{ border-color:#e53935; color:#e53935; }
#btnToggleSpent.active{ background:#e53935; color:#fff; border-color:#e53935; }
#btnToggleVisited{ border-color:#1e90ff; color:#1e90ff; }
#btnToggleVisited.active{ background:#1e90ff; color:#fff; border-color:#1e90ff; }


/* === Added by ChatGPT: Uniform Location Controls (input + 2 buttons) === */
.location-row{
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 8px;
  align-items: stretch;
}
.location-row label{
  display: flex;
  align-items: center;
  justify-content: center;
  height: 44px;
  padding: 0;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: transparent;
}
.location-row label .input{
  width: 100%;
  height: 100%;
  border: none;
  background: transparent;
  text-align: center;
  padding: 0;
  font-size: 14px;
  line-height: 44px;
}
.location-row .location-btn{
  width: 100%;
  height: 44px;
  padding: 10px 12px;
  border-radius: 12px;
}
@media (max-width: 520px){
  .location-row{ grid-template-columns: 1fr 1fr; }
  .location-row > *:last-child{ grid-column: 1 / -1; }
}
/* === End addition === */



/* === Share card spacing improvements === */
#view-share .cards .card:last-child .row{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:16px;
}
#view-share .cards .card:last-child .row + .row{ margin-top:14px; }
#view-share .cards .card:last-child .btn{ width:100%; }
#view-share .cards .card:last-child .input{ width:100%; }


/* === Spacing fixes for ייבוא/ייצוא/שיתוף panel === */
#view-share .card .row{
  gap: 12px;
  margin-bottom: 12px;
  align-items: center;
  flex-wrap: wrap;
}
#view-share .input,
#view-share .btn,
#view-share select.input{
  height: 44px; /* consistent control height */
}
#view-share .card h3{
  margin-bottom: 10px;
}

/* extra spacing refinement for import/export cards */
#view-share .card .row + .row { margin-top: 12px; }
#view-share input[type="file"].input { padding: 10px 12px; }




/* Any email/user pill element */
header :is(#userBadge, #userEmail, .user-pill, .email-pill) { order: 20 !important; }




/* === Mobile Preview Presets === */
#previewRoot{
  display:flex;
  justify-content:center;
  align-items:flex-start;
  height:100dvh;              /* גובה מסך מלא נקי */
  overflow:hidden;            /* ביטול גלילה חיצונית */
  gap:0;
}
.mobile-preview-controls{
  display:flex;
  gap:.5rem;
  align-items:center;
}
.mobile-preview-controls .select{
  padding:.55rem .8rem;
  border:1px solid var(--border, #e5e7eb);
  border-radius:999px;
  background:var(--bg, #fff);
  font:inherit;
  direction:ltr;
}
body.mobile-preview{
  overflow:auto;
}
body.mobile-preview .app{
  width:428px;   /* default iPhone 13 Pro Max */
  height:926px;
  border:1px solid var(--border, #e5e7eb);
  border-radius:28px;
  box-shadow:0 10px 25px rgba(0,0,0,.12);
  overflow:auto;
  background:var(--bg, #fff);
  margin:0 auto;
}
#btnMobilePreview.active{ outline:2px solid rgba(0,0,0,.15); }
/* end of Mobile Preview Presets */


/* Force-hide mobile preview/device UI (all variants) */
.mobile-preview-controls,
#btnMobilePreview,
.btn-mobile-preview,
#btnRotate,
.btn-rotate,
#devicePreset,
.device-preset,
.device-selector,
.device-size,
.device-pill,
button[aria-label*="מובייל"],
button[title*="מובייל"],
button[aria-label*="Mobile"],
button[title*="Mobile"],
[data-mobile-ui],
[data-test="device-select"],
[data-test="mobile-toggle"]{
  display:none !important;
}


/* clickable types pill */
.trip-row .pill{ cursor: pointer; }
.pill.active{ outline: 2px solid color-mix(in oklab, var(--brand) 40%, transparent); }

/* Kill-switch for dev mobile controls */
header .mobile-preview-controls{display:none !important}
#btnMobilePreview,#btnRotate,#devicePreset{display:none !important}


/* Hard kill: hide any header button that renders a phone-rect icon */
header .btn:has(svg rect[x="5"][y="2"][width="14"][height="20"]) { display:none !important; }

#miniMap{height:320px;border-radius:16px;}

/* === Journal: vertical cards, no horizontal scroll === */
.journal-list{
  display:flex;
  flex-direction:column;
  gap:12px;
  width:100%;
}
.journal-card{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 12px 14px;
  box-shadow: var(--shadow);
  display: grid;
  grid-template-columns: 1fr auto; /* text + menu */
  gap: 8px;
  overflow-wrap: anywhere;       /* long words/links won't cause horizontal scroll */
  word-break: break-word;
}
.journal-card .meta{
  display:flex;
  flex-wrap: wrap;
  gap:8px;
  color: var(--muted);
  font-size: .95rem;
}
.journal-card .title{
  font-weight: 600;
}
.journal-card .text{
  grid-column: 1 / -1;
  line-height: 1.5;
}
.journal-card .menu-btn{
  justify-self: end;
  border: 1px solid var(--border);
  background: transparent;
  border-radius: 10px;
  padding: 6px 10px;
}
.content{ overflow-x: hidden; } /* never horizontal scroll */
/* Mobile: keep same stacking */
@media (max-width: 720px){
  .journal-card{ grid-template-columns: 1fr auto; }
}

/* --- Link / Mail icon badges inside journal/expenses text --- */




/* --- Blue link/mail chips --- */
:root{ --link-blue:#1a73e8; }






/* === Override: link/mail display as blue icons only === */






:root { --link-blue: #1a73e8; }






/* === Link/Mail icons: emoji-only, blue (requested) === */
:root{ --link-blue: #1a73e8; }




/* === Single source of truth: link/mail icons === */
:root{ --link-blue: #1a73e8; }
.link-icon, .mail-icon{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:26px; height:26px; /* bigger icon */
  margin: 0 6px;
  text-decoration:none;
  background: transparent;
  border:none;
  box-shadow:none;
  color: var(--link-blue);
}

.mail-icon::before{ content:"✉️"; font-size:18px; line-height:1; }

/* Force link icon as blue SVG (not emoji) */
.link-icon{
  color:#1a73e8 !important;
}


/* Force blue link icon and 50% larger size */
.link-icon{
  width:30px !important;
  height:30px !important;
}
.link-icon::before{
  content:'';
  display:inline-block;
  width:30px; height:30px;
  background-image:url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><g transform='rotate(-18 12 12)' fill='none' stroke='%231a73e8' stroke-width='2'><ellipse cx='12' cy='8' rx='5' ry='3.8'/><ellipse cx='12' cy='16' rx='5' ry='3.8'/></g></svg>\");
  background-repeat:no-repeat;
  background-position:center;
  background-size:30px 30px;
}

/* --- Align link/mail icons with text baseline --- */
.link-icon, .mail-icon{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  vertical-align: middle;   /* center on line box */
  line-height: 1;           /* avoid extra ascent */
  position: relative;
  top: -1px;                 /* nudge down a touch for optical alignment */
}
.link-icon::before, .mail-icon::before{
  display:block;            /* no inline extra baseline */
}

/* Make yellow mark clickable */
.hl-pill, .hl-pill mark{ cursor: pointer; }


/* === Expenses table (custom) === */
#view-expenses .expenses-table-container{ overflow-x:auto; }
#view-expenses .expenses-table{ width:100%; border-collapse:separate; border-spacing:0; direction:rtl; }
#view-expenses .expenses-table th, #view-expenses .expenses-table td{ border-bottom:1px solid var(--border); padding:10px; text-align:right; }
#view-expenses .expenses-table th{ background:var(--card); position:sticky; top:0; z-index:1; }
#view-expenses .expenses-table th.narrow{ width:56px; }


/* === Stacked expenses layout === */
#view-expenses .expenses-table.stacked { width:100%; border-collapse:separate; border-spacing:0; }
#view-expenses .expenses-table.stacked td.cell { border:1px solid var(--border); padding:10px; vertical-align:middle; }
#view-expenses .expenses-table.stacked td.header { background: rgba(255, 120, 120, 0.20) !important; /* light red */ }
#view-expenses .expenses-table.stacked td.header .lbl { font-weight:700; margin-inline-end:6px; }
#view-expenses .expenses-table.stacked td.menu { width:56px; text-align:center; background: color-mix(in oklab, var(--ink) 6%, transparent); }
#view-expenses .expenses-table.stacked tr.exp-item + tr.exp-item td { border-top:none; } /* merge look */
#view-expenses .expenses-table.stacked td.notes { color: var(--ink); }

#view-expenses .expenses-table.stacked td.menu-cell{
  width:56px; text-align:center;
  background: color-mix(in oklab, var(--ink) 6%, transparent);
}
#view-expenses .expenses-table.stacked td.menu-cell .menu-btn{
  inline-size: 36px; block-size: 32px; border-radius: 10px;
}

/* Balance widths when using 6 columns on first row */
#view-expenses .expenses-table.stacked td.header.date,
#view-expenses .expenses-table.stacked td.header.time,
#view-expenses .expenses-table.stacked td.header.category,
#view-expenses .expenses-table.stacked td.header.amount,
#view-expenses .expenses-table.stacked td.header.currency { min-inline-size: 10ch; }
#view-expenses .expenses-table.stacked td.menu-cell{ width:56px; text-align:center; }

/* Dual amount display */
#view-expenses .expenses-table.stacked .amount .amt-main{ font-weight:700; line-height:1.1; }
#view-expenses .expenses-table.stacked .amount .amt-main .code{ font-weight:600; margin-inline-start:.3ch; opacity:.9; }
#view-expenses .expenses-table.stacked .amount .amt-ils{ font-size:.9em; margin-top:.2rem; }

/* Amount + ILS split */
#view-expenses .expenses-table.stacked .amount .amt-main{ font-weight:700; line-height:1.1; }
#view-expenses .expenses-table.stacked .amount .amt-main .code{ font-weight:700; margin-inline-end:.3ch; }
#view-expenses .expenses-table.stacked .currency .ils-total{ font-weight:600; }


/* === One-line actions + budget bar === */
#view-expenses .list-actions{
  display:flex;
  align-items:center;
  gap:12px;
  justify-content:space-between;
  flex-wrap:nowrap;
}
#view-expenses .list-actions #expenseSummary{
  margin-inline-start:auto;
}
#view-expenses .budget-bar{ flex-wrap:nowrap; }
#view-expenses .budget-progress{ min-width:160px; }


/* === Responsive: stack actions & budget on small screens === */
@media (max-width: 720px){
  #view-expenses .list-actions{
    flex-wrap: wrap;
    gap: 10px;
  }
  #view-expenses .list-actions #expenseSummary{
    order: 3;            /* push summary below buttons */
    width: 100%;
  }
  #view-expenses .budget-bar{
    width: 100%;
    flex-wrap: wrap;
    gap: 10px;
  }
  #view-expenses .budget-bar .kpi{
    flex: 1 1 calc(33% - 10px);
    min-width: 120px;
  }
  #view-expenses .budget-progress{
    flex: 1 1 100%;
    min-width: 0;
  }
}
@media (max-width: 480px){
  #view-expenses .budget-bar .kpi{
    flex: 1 1 calc(50% - 10px); /* two per row if very narrow */
    min-width: 140px;
  }
}


/* rate-line styling to match heading weight */
.rate-line{display:flex;align-items:baseline;gap:.35rem;font-weight:800;color:#0B1320}
.rate-line .rate-code{letter-spacing:.5px}
.rate-line{direction:ltr;unicode-bidi:plaintext}

.cell.header.amount .amt-sub{display:block!important}


/* Amount sub-line: small, non-bold ILS rate under main amount */
#view-expenses .expenses-table.stacked .amount .amt-sub{
  margin-top: .25rem;
  font-size: .85em;
  font-weight: 400;
  color: var(--muted);
}



/* Left cell now shows converted ILS total */
#view-expenses .expenses-table .converted-ils{
  font-weight: 500;
}


#view-expenses .expenses-table .currency .ils-total{font-weight:600;}


/* --- Journal adopts the stacked expenses visual --- */
.journal-list{
  display:flex;
  flex-direction:column;
  gap:12px;
  width:100%;
}
.journal-card{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 12px 14px;
  box-shadow: var(--shadow);
  display: grid;
  grid-template-columns: 1fr auto; /* text + menu */
  gap: 8px;
  overflow-wrap: anywhere;       /* long words/links won't cause horizontal scroll */
  word-break: break-word;
}
.journal-card .meta{
  display:flex;
  flex-wrap: wrap;
  gap:8px;
  color: var(--muted);
  font-size: .95rem;
}
.journal-card .title{
  font-weight: 600;
}
.journal-card .text{
  grid-column: 1 / -1;
  line-height: 1.5;
}
.journal-card .menu-btn{
  justify-self: end;
  border: 1px solid var(--border);
  background: transparent;
  border-radius: 10px;
  padding: 6px 10px;
}
.content{ overflow-x: hidden; } /* never horizontal scroll */
/* Mobile: keep same stacking */
@media (max-width: 720px){
  .journal-card{ grid-template-columns: 1fr auto; }
}

/* explicit text link used when a journal line is a single URL */
.text-link{ text-decoration: underline; color: var(--primary); font-weight: 500; }

/* journal text anchors always look like links */
#view-journal .journal-list .text a.text-link{ text-decoration: underline; color: var(--primary); font-weight: 500; }
#view-journal .journal-list .text a{text-underline-offset: 2px;}


/* Numbered pins for map */
.leaflet-div-icon { background: transparent; border: none; }
.num-pin{ position: relative; width: 28px; height: 28px; border-radius: 50%; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:12px; box-shadow: 0 2px 6px rgba(0,0,0,.25); }
.num-pin.red{ background:#e53935; color:#fff; border:2px solid #b71c1c; }
.num-pin.green{ background:#34a853; color:#fff; border:2px solid #1b5e20; }
.num-pin::after{ content:""; position:absolute; bottom:-6px; left:50%; transform:translateX(-50%) rotate(45deg); width:10px; height:10px; background:inherit; border-bottom:inherit; border-right:inherit; }


/* highlight on 'הצג' focus */
.pulse { outline: 2px solid #ff9800; box-shadow: 0 0 0 4px rgba(255,152,0,.3); transition: box-shadow .3s; }
.map-popup .btn.small { font-size:.85rem; padding:.25rem .5rem; }


/* Auto-resize helper for textareas */
.auto-resize{min-height:84px;overflow:hidden;resize:vertical}


/* Share tab stacking override (high specificity) */
body #view-share .cards{display:flex !important; flex-direction:column !important; gap:16px !important; grid-template-columns:none !important}
body #view-share .cards .card{width:100% !important; max-width:100% !important}

/* map-toolbar-visited */
.map-toolbar #btnToggleVisited { border:2px solid #34a853; color:#34a853; background:transparent; }
.map-toolbar #btnToggleVisited.active { background:#34a853; color:#fff; border-color:#1b5e20; }

/* Selection UI */
.journal-card{ position:relative; }
.journal-card.select-mode{ padding-inline-start:42px; }
.jr-select-box{ position:absolute; left:12px; top:12px; display:flex; align-items:center; z-index:5; pointer-events:auto; }
.jr-select-box input[type="checkbox"]{ width:18px; height:18px; accent-color:#e53935; }

#btnCancelSelectionJournal{ margin-inline-start: 8px; }

/* Desktop-only full-width mode */
@media (min-width: 1024px){
  body{ overflow-x:hidden; }
  .container{ grid-template-columns: 320px 1fr; }
  .container.home-mode{ grid-template-columns: 1fr; }
  .container.home-mode .sidebar{ width:100%; max-width:none; margin:0; }
  #tripList.grid{ width:100%; }
  .cards{ grid-template-columns: repeat(auto-fill, minmax(420px, 1fr)); }
}

/* Desktop: app spans full width */
#previewRoot{ justify-content: flex-start; }
#previewRoot > .app{ width:100%; max-width:none; margin:0; }


/* Journal header row (date, time, place) same look as Expenses headers */
#view-journal .expenses-table td.header{
  background: rgba(140, 255, 140, 0.20) !important; /* light green */
}
#view-journal .expenses-table td.menu-cell{
  width:56px; text-align:center;
  background: rgba(140, 255, 140, 0.20) !important; /* light green */
}


/* Emphasize labels in Journal header row */
#view-journal .expenses-table td.header .lbl{
  color: var(--ink);
  font-weight: 800;
  letter-spacing: 0.2px;
}

.app.show{display:block;}


/* Import card button layout */
#view-share .card .row.buttons-3 { gap:12px; flex-wrap:wrap }
#view-share .btn { min-width: 140px; }

/* ==== Share Tab: three-card full fit, no scrollbars ==== */
html.share-open, body.share-open { overflow: hidden !important; }
#view-share {
  display:flex;
  flex-direction:column;
  height: calc(100dvh - 120px);
  overflow: hidden;
}
#view-share .cards.share-grid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  flex:1;
  align-items:stretch;
  overflow: hidden;
}
#view-share .card{ display:flex; flex-direction:column; gap:12px; overflow:hidden; }
#view-share .card .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
#view-share .btn{ min-width:140px; }
@media (max-width: 1100px){
  #view-share{ height: calc(100dvh - 140px); }
  #view-share .cards.share-grid{ grid-template-columns: repeat(2,1fr); }
}
@media (max-width: 720px){
  html.share-open, body.share-open { overflow:auto !important; } /* allow mobile scroll if needed */
  #view-share .cards.share-grid{ grid-template-columns: 1fr; }
}


/* === ABSOLUTE NO-SCROLL mode for Share tab === */
html.share-open, body.share-open { overflow: hidden !important; height:100%; }
html.share-open * { scrollbar-width: none !important; }
html.share-open *::-webkit-scrollbar { width: 0 !important; height: 0 !important; display: none !important; }
/* Ensure common containers don't reintroduce scroll */
html.share-open #app,
html.share-open .app,
html.share-open .layout,
html.share-open .container,
html.share-open .content,
html.share-open .sidebar,
html.share-open .main,
html.share-open [class*="scroll"],
html.share-open [style*="overflow: auto"],
html.share-open [style*="overflow:auto"],
html.share-open [style*="overflow: scroll"],
html.share-open [style*="overflow:scroll"]{
  overflow: hidden !important;
  overscroll-behavior: contain !important;
  max-height: 100dvh !important;
}
/* Share view itself fills viewport and clips overflow */
#view-share{
  height: calc(100dvh - 120px);
  overflow: clip !important;
}

#currentUserEmail{font-size:14px; opacity:.8;}

/* Robust tab visibility & scrolling */
.tabview{ display:none !important; }
.tabview[data-active="1"] {
  display: block !important;
  flex: 1;
  overflow-y: auto !important; /* גלילה אנכית חובה */
  overflow-x: hidden;
  padding: 16px;
  min-height: 0;
  -webkit-overflow-scrolling: touch; /* גלילה חלקה במכשירי iOS */
}{ display:block !important; flex:1; overflow:auto; padding:16px; min-height:0; }

/* map-toolbar-spent */
.map-toolbar #btnToggleSpent { border:2px solid #e53935; color:#e53935; background:transparent; }
.map-toolbar #btnToggleSpent.active { background:#e53935; color:#fff; border-color:#b71c1c; }

/* journal selection checkbox cell */
.expenses-table .cell.select-cell { width:42px; text-align:center; }
.expenses-table .cell.select-cell input { transform: scale(1.2); }
.btn.danger.outline{ background:transparent; border:2px solid #e53935; color:#e53935; }
.btn.ghost{ background:transparent; border:0; color:#666; }

.chip-btn{display:inline-flex;align-items:center;justify-content:center;padding:8px 14px;border-radius:9999px;border:1px solid var(--border);background:var(--panel,#fff);color:var(--text,#111);font-weight:500;line-height:1;cursor:pointer}
.chip-btn:hover{background:color-mix(in oklab,var(--panel,#fff) 92%,var(--brand,#4B7) 8%)}
.chip-btn.ghost{background:transparent}

.modal{border:none;border-radius:20px;padding:0;width:min(720px,94vw)}
.modal .header{position:sticky;top:0;display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border);background:var(--panel,#fff);border-top-left-radius:20px;border-top-right-radius:20px}
.modal .body{padding:16px;max-height:min(70vh,760px);overflow:auto}
.modal::backdrop{background:rgba(0,0,0,.35)}

.breakdown-table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed}
.breakdown-table th,.breakdown-table td{padding:10px;border-bottom:1px solid var(--border);text-align:right;vertical-align:top}
.breakdown-row-bar{height:10px;background:color-mix(in oklab,var(--brand) 25%,transparent);border-radius:9999px;overflow:hidden}
.breakdown-row-bar>span{display:block;height:100%;background:var(--brand);width:0}
.breakdown-total{font-weight:600}


/* --- Breakdown: expandable categories --- */
.breakdown-head{display:flex;align-items:center;justify-content:flex-end;margin-bottom:10px}
.breakdown-note{font-size:13px;color:var(--muted,#6b7280)}

.breakdown-cat-row{cursor:pointer;user-select:none}
.breakdown-cat-row:hover{background:transparent}
.breakdown-cat-row.open{background:transparent}
.breakdown-cat-row .bd-toggle{display:inline-block;min-width:18px;margin-inline-end:6px;color:var(--muted,#6b7280)}
.breakdown-cat-row .bd-count{margin-inline-start:6px;color:var(--muted,#6b7280);font-size:12px}

.breakdown-details{display:none;background:transparent}
.breakdown-details.open{display:table-row}
.breakdown-details td{padding:0;border-bottom:1px solid var(--border)}

.bd-details-wrap{padding:12px 12px 14px}
.bd-items{width:100%;border-collapse:separate;border-spacing:0}
.bd-items{table-layout:fixed}
.bd-items th,.bd-items td{padding:10px 12px;border-bottom:1px dashed color-mix(in oklab,var(--border) 70%,transparent);text-align:right;vertical-align:top}
.bd-items thead th{font-size:12px;color:var(--muted,#6b7280);font-weight:600}
.bd-item-title{font-weight:400;line-height:1.35;word-break:break-word;overflow-wrap:anywhere}
.bd-item-when{margin-top:2px;font-size:12px}
.bd-item-amt,.bd-item-ils{white-space:nowrap}

/* Make long RTL/EN descriptions wrap nicely */
.breakdown-table td,.breakdown-table th,
.breakdown-missing-table td,.breakdown-missing-table th{word-break:break-word;overflow-wrap:anywhere}

/* Column sizing for breakdown tables */
.breakdown-table .bd-cat{width:44%}
.breakdown-table .bd-sum{width:20%}
.breakdown-table .bd-pct{width:36%}
.bd-items th:nth-child(1), .bd-items td:nth-child(1){width:60%}
.bd-items th:nth-child(2), .bd-items td:nth-child(2){width:22%}
.bd-items th:nth-child(3), .bd-items td:nth-child(3){width:18%}

.breakdown-warning{
  margin-top:12px;
  padding:12px 14px;
  border:1px solid var(--border);
  border-radius:14px;
  background: color-mix(in oklab, var(--panel,#fff) 94%, #000 6%);
}

.breakdown-missing{
  margin-top:12px;
  padding:12px 14px;
  border:1px solid var(--border);
  border-radius:14px;
  background: color-mix(in oklab, var(--panel,#fff) 85%, transparent);
}

.breakdown-missing-title{
  font-weight:600;
  margin-bottom:8px;
}

.breakdown-missing-table{width:100%;border-collapse:separate;border-spacing:0}
.breakdown-missing-table th,.breakdown-missing-table td{padding:8px 10px;border-bottom:1px solid var(--border);text-align:right;vertical-align:top}
.breakdown-missing-table thead th{position:sticky;top:0;background:var(--panel,#fff)}
.breakdown-missing-table tbody{display:table-row-group}


/* highlight target row when navigated from map popup */
.flash-green { 
  background: #e6ffe9 !important; 
  transition: background 0.6s ease;
  box-shadow: inset 0 0 0 2px #3bb273;
}


/* ensure block highlight paints all cells in the row */
.flash-green > * { background: #e6ffe9 !important; }


/* === Mobile rigid layout fixes (iPhone 13 Pro Max) === */
@media (max-width: 480px){
  html, body { width:100%; max-width:100%; overflow-x:hidden; overscroll-behavior-x: none; }
  body { overflow-y:auto; touch-action: manipulation; }
  .app, .container, .content, .sidebar, .section, .card, .panel, .sheet, .modal, .tabs, header, nav { max-width:100%; min-width:0; }
  .row, .flex, header, nav, .tabs, .toolbar { display:flex; flex-wrap:wrap; min-width:0; }
  * { box-sizing: border-box; }
  img, svg, video, canvas, iframe { max-width:100%; height:auto; }
  .leaflet-container, #map, .map, .map-container { width:100% !important; max-width:100% !important; }
  .leaflet-container { height: 60vh !important; }
  table { width:100%; table-layout: fixed; border-collapse: collapse; }
  th, td { word-break: break-word; min-width:0; }
  input, select, textarea, button { max-width:100%; }
  /* prevent accidental fixed widths from causing horizontal scroll */
  [style*="width:"] { max-width:100%; }
}

/* Global overflow guard */
html, body { overflow-x:hidden; }



/* === Journal header layout: desktop one-line, mobile two-lines === */
/* Desktop: single row — Date | Time | Location | Menu */
@media (min-width: 481px){
  #view-journal .expenses-table tr.exp-item:has(td.header){
    display: grid;
    grid-template-columns: auto auto 1fr auto;
    grid-template-areas: "date time location menu";
    align-items: center;
    gap: 0;
    background: rgba(140, 255, 140, 0.20) !important; /* <-- שורה זו שונתה */
  }
  #view-journal .expenses-table tr.exp-item:has(td.header) td.cell{
    background: transparent !important;
  }
  #view-journal .expenses-table td.header.location{ 
    min-width: 0; 
  }
  #view-journal .expenses-table td.header.location .val{
    display: block;
    overflow: visible;
    white-space: nowrap;
    text-overflow: ellipsis; /* in case the name is very long */
    max-width: 100%;
  }
}
/* Mobile rules (<=480px) already exist below: 1st row date+time, 2nd row location. */
/* ======== Mobile-only compact headers for Expenses & Journal ======== */
@media (max-width: 480px){

  /* Shared */
  #view-expenses .expenses-table, 
  #view-journal .expenses-table { border-spacing:0; width:100%; }
  
  /* Base item styles */
  #view-expenses .expenses-table tr.exp-item,
  #view-journal .expenses-table tr.exp-item {
      display: grid; /* Use grid for both, but different templates */
      align-items: center;
      background: transparent; 
      padding: 0; 
      margin-bottom: 8px; /* Space between items */
      border-radius: 0; 
  }

  /* --- Expenses: Header Row (tr1) --- */
  #view-expenses .expenses-table.stacked tr.exp-item:has(td.header),
  #view-overview .expenses-table tr.exp-item[data-kind="expense"]:has(td.header) {
    grid-template-columns: 1fr 1fr auto;
    grid-template-areas: "date time menu"
                         "amount currency menu";
    gap: 0;
    /* Add the grey background to the header row itself */
    background: rgba(255, 120, 120, 0.20) !important;
    border-radius: 8px; /* Round the corners of the header block */
  }
  
  /* Cells inside the header row */
  #view-expenses .expenses-table.stacked tr.exp-item:has(td.header) td.cell {
      border: none;
      padding: .5rem .75rem;
      background: transparent !important; /* Cells are transparent, TR has color */
  }

  /* Area assignments for header cells */
  #view-expenses .expenses-table.stacked td.header.date{ grid-area:date; }
  #view-expenses .expenses-table.stacked td.header.time{ grid-area:time; }
  #view-expenses .expenses-table.stacked td.header.amount{ grid-area:amount; }
  #view-expenses .expenses-table.stacked td.header.currency{ grid-area:currency; }
  #view-expenses .expenses-table.stacked td.menu-cell{ grid-area:menu; text-align:left; padding: .5rem 0 .5rem .75rem; }
  #view-expenses .expenses-table.stacked td.header.category{ display:none; }

  /* --- Expenses: Notes Row (tr4) --- */
  #view-expenses .expenses-table.stacked tr.exp-item:has(td.notes),
  #view-overview .expenses-table tr.exp-item[data-kind="expense"]:has(td.notes) {
      display: block; /* Revert to block display for the notes row */
      margin-top: -4px; /* Pull it closer to the header row */
      margin-bottom: 8px; /* Keep space to next item */
  }
  
  #view-expenses .expenses-table.stacked td.notes {
      grid-column: 1 / -1;
      padding: .5rem .75rem;
      background: transparent; /* Notes cell is transparent */
      border: none; /* <-- הוסר כל הקו (עליון ותחתון) */
   }

  /* טיפוגרפיה */
  #view-expenses .expenses-table.stacked .amount .amt-main{ font-weight:700; }
  #view-expenses .expenses-table.stacked .currency .ils-total{ font-weight:700; }
  #view-expenses .expenses-table.stacked .amt-sub{ font-size:.85em; opacity:.8; }

  /* --- Journal: Header Row (tr1) --- */
  #view-journal .expenses-table tr.exp-item:has(td.header),
  #view-overview .expenses-table tr.exp-item[data-kind="journal"]:has(td.header){ 
    grid-template-columns: 1fr 1fr auto;
    grid-template-areas: "date time menu"
                         "location location menu";
    gap: 0; 
    background: rgba(140, 255, 140, 0.20) !important;
    padding: 0;
    margin-bottom: 0; /* No margin-bottom, notes row will handle spacing */
    border-radius: 8px;
  }
  
  /* Cells inside journal header row */
  #view-journal .expenses-table tr.exp-item:has(td.header) td.cell {
      border:none;
      padding: .5rem .75rem;
      background: transparent !important;
  }
  
  #view-journal .expenses-table td.header.date{ grid-area:date; }
  #view-journal .expenses-table td.header.time{ grid-area:time; }
  #view-journal .expenses-table td.header.location{ grid-area:location; }
  #view-journal .expenses-table td.menu-cell{ grid-area:menu; text-align:left; padding: .5rem 0 .5rem .75rem; /* Adjust menu padding */ }

  /* --- Journal: Notes Row (tr4) --- */
  #view-journal .expenses-table tr.exp-item:has(td.notes),
  #view-overview .expenses-table tr.exp-item[data-kind="journal"]:has(td.notes) {
      display: block; /* Revert to block display */
      margin-top: -4px; /* Pull it closer */
      margin-bottom: 8px; /* Space to next item */
  }
  
  #view-journal .expenses-table td.notes {
      grid-column: 1 / -1;
      padding: .5rem .75rem;
      background: transparent; 
      border: none; /* <-- הוסר כל הקו (עליון ותחתון) */
  }


  /* הסתרת תאי בחירה במובייל ברירת מחדל (כשאין מצב בחירה) */
  #view-journal .expenses-table td.select-cell,
  #view-expenses .expenses-table td.select-cell{ display:none; }

  /* --- Trip meta (נתוני נסיעה): קריא ונוח --- */
  #view-meta .section .row,
  #view-meta .budget-row,
  #view-meta .budget-actions-row{ display:grid; grid-template-columns: 1fr; gap:.6rem; }
  #view-meta .chips, #view-meta .pill-group, #view-meta .tag-row{ display:flex; flex-wrap:wrap; gap:.4rem; }
  #view-meta input, #view-meta select, #view-meta textarea{ width:100%; }
  #view-meta .budget-block{ padding:1rem; }
  #view-meta .budget-row{ grid-template-columns: repeat(2, 1fr); }
  #view-meta .budget-row label{ width:100%; }

}

/* --- Mobile-only Logout Button --- */
.btn-logout-mobile{ display:none; }
@media (max-width: 768px){
  .btn-logout-mobile{ display:inline-flex; align-items:center; padding:.6rem .9rem; font-weight:600; border-radius:12px; }
  .btn-logout-mobile.btn.danger{ background:#ffe8e8; border:1px solid #ffb3b3; }
}

/* iOS viewport fix */
html, body { height:100%; }
:root{ --vh: 1dvh; }
.app, .container, .page, .main { min-height: 100svh; min-height: 100dvh; min-height: -webkit-fill-available;}


/* URLs in journal outputs wrap cleanly */
#tblJournal a, #tblRecentJournal a { word-break: break-all; display:inline; }

/* === RTF editor === */
.input.rtf{ min-height:120px; overflow:auto; white-space:pre-wrap; }
.input.rtf *{ font-family: inherit; }
.input.rtf:focus{ outline:2px solid color-mix(in oklab, var(--brand) 40%, transparent); }
.rtf-bubble{ position:absolute; z-index:1000; background:var(--card); border:1px solid var(--border); border-radius:14px; padding:6px 8px; display:flex; gap:10px; box-shadow:var(--shadow); transform:translate(-50%,-100%); }
.rtf-bubble .colors,.rtf-bubble .styles{ display:flex; gap:6px; align-items:center; }
.rtf-bubble .dot{ width:16px; height:16px; border-radius:50%; border:1px solid var(--border); cursor:pointer; padding:0; }
.rtf-bubble .dot[data-color="#FFD60A"]{ background:#FFD60A; }
.rtf-bubble .dot[data-color="#E53935"]{ background:#E53935; }
.rtf-bubble .dot[data-color="#1E88E5"]{ background:#1E88E5; }
.rtf-bubble .dot[data-color="#34A853"]{ background:#34A853; }
.rtf-bubble .dot[data-color="#000000"]{ background:#000000; }
.rtf-bubble .fmt{ border:1px solid var(--border); background:transparent; border-radius:10px; padding:2px 8px; cursor:pointer; font-weight:700; }
#journalModal .body{ position:relative; }
#tblJournal a, #tblRecentJournal a { word-break: break-all; display:inline; }


/* Blue link icon for long/raw links */
.link-chip{ color:#1E88E5; font-weight:700; text-decoration:none; }


/* Ensure long/raw links show as blue icon inside editor as well */
#jrText a.link-chip{ color:#1E88E5; font-weight:77; text-decoration:none; }
#jrText a{ word-break: break-all; }

/* Bubble interaction tweaks */
.rtf-bubble{ pointer-events:auto; box-shadow: 0 8px 24px rgba(0,0,0,.08); }


/* === RTF bubble -> docked toolbar (sticky, bottom-centered) === */
#journalModal .body{ position: relative; }
#journalModal .input.rtf{ padding-bottom: 72px; } /* space so toolbar won't overlap text */
#journalModal .rtf-bubble{
  position: sticky;
  bottom: 8px;
  left: 0;
  right: 0;
  transform: none;
  margin-inline: auto;
  z-index: 1100;
  display: flex;
  justify-content: center;
  gap: 10px;
  max-width: calc(100% - 16px);
  overflow-x: auto;
  overscroll-behavior: contain;
  pointer-events: auto;
}
#journalModal .rtf-bubble .colors,
#journalModal .rtf-bubble .styles{
  display:flex; gap:8px; align-items:center; flex-wrap:nowrap;
}
#journalModal .rtf-bubble.hidden{ display: none !important; }

#expenseModal .body{ position: relative; }
#expenseModal .input.rtf{ padding-bottom: 72px; }
#expenseModal .rtf-bubble{ position: sticky; bottom: 8px; left:0; right:0; transform:none; margin-inline:auto; z-index:1100; display:flex; justify-content:center; gap:10px; max-width:calc(100% - 16px); overflow-x:auto; pointer-events:auto; }
#expenseModal .rtf-bubble .colors, #expenseModal .rtf-bubble .styles{ display:flex; gap:8px; align-items:center; }
#expenseModal .rtf-bubble.hidden{ display:none!important; }


/* === Notes line-break fidelity (expenses + journal) === */
#view-expenses .cell.notes,
#view-journal  .cell.notes,
#tblRecentExpenses td:first-child,
#tblRecentJournal  td:nth-child(3){
  white-space: pre-wrap;     /* preserve \n from editor */
  word-break: break-word;
}
/* Remove default margins from contentEditable output */
#view-expenses .cell.notes div,
#view-journal  .cell.notes div,
#view-expenses .cell.notes p,
#view-journal  .cell.notes p{
  margin: 0;
  padding: 0;
}


.link-icon::before{
  content:'';
  display:inline-block;
  width:30px; height:30px;
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'><g transform='rotate(-20 12 12)' stroke='%231a73e8' stroke-width='2' fill='none' stroke-linecap='round'><circle cx='12' cy='8' r='4'/><circle cx='12' cy='16' r='4'/></g></svg>");
  background-repeat:no-repeat;
  background-position:center;
  background-size:30px 30px;
}


/* === Exact line-break preservation in notes cells (expenses + journal) === */
#view-expenses .cell.notes,
#view-journal  .cell.notes {
  white-space: break-spaces;   /* preserve spaces and newlines 1:1 */
  word-break: break-word;      /* avoid horizontal scroll */
}


.link-icon::before{
  content:'';
  display:inline-block;
  width:30px; height:30px;
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'><g fill='none' stroke='%231a73e8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><g transform='rotate(35 8 12)'><rect x='1' y='6' width='14' height='6' rx='3' ry='3'/></g><g transform='rotate(35 16 12)'><rect x='9' y='12' width='14' height='6' rx='3' ry='3'/></g></g></svg>");
  background-repeat:no-repeat;
  background-position:center;
  background-size:30px 30px;
}

.link-icon::before{
  content:'';
  display:inline-block;
  width:24px; height:24px;
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><g transform='rotate(30 12 12)' fill='none' stroke='%231a73e8' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'><rect x='2' y='9' width='10' height='6' rx='3' ry='3'/><rect x='12' y='9' width='10' height='6' rx='3' ry='3'/><path d='M10 12h4'/></g></svg>");
  background-repeat:no-repeat;
  background-position:center;
  background-size:24px 24px;
}

/* std link-icon sizing */
.link-icon{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:24px; height:24px;
  margin: 0 6px;
  vertical-align: middle;
  text-decoration:none;
}
.link-icon:hover::before{
  filter: brightness(0.85);
}

/* center only the requested title */
.center-title{ text-align:center; }

/* --- Ensure blue link icon renders correctly in Journal (list + editor) --- */
#tblJournal a.link-icon,
#tblRecentJournal a.link-icon,
#jrText a.link-icon{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  vertical-align:middle;
  text-decoration:none;
}

/* --- Logout button (fixed) --- */
#logoutBtn{
  position: fixed;
  top: 14px;
  inset-inline-end: 14px; /* RTL/LTR aware */
  z-index: 9999;
  padding: 10px 14px;
  border: 1px solid #0000001a;
  border-radius: 12px;
  background: #ffffff;
  font-size: 14px;
  line-height: 1;
  box-shadow: 0 2px 10px rgba(0,0,0,.06);
  cursor: pointer;
}
#logoutBtn:active{ transform: translateY(1px); }
@media (max-width: 768px){
  #logoutBtn{ top: 10px; inset-inline-end: 10px; padding: 10px 12px; font-size: 15px; }
}

/* Removable link X inside editors */
.rtf a.link-icon, .rtf a.mail-icon{ position:relative; display:inline-flex; }
.rtf a .link-x{ position:absolute; top:-6px; right:-6px; width:16px; height:16px; line-height:16px; font-size:11px; text-align:center; border-radius:50%; background:#e53935; color:#fff; cursor:pointer; display:none; z-index: 5; }
.rtf a:hover .link-x{ display:block; }

/* === FIX: Redesign Share Tab Button Layout === */

/* 1. Target the button rows in Import & Export cards */
#view-share #card-import .row,
#view-share #card-export .row {
  display: grid !important; /* Override inline style */
  grid-template-columns: 1fr 1fr; /* 2 buttons per row */
  gap: 10px; /* A clean gap */
  flex-wrap: normal !important; /* Disable inline flex-wrap */
}

/* 2. Remove min-width on buttons *only* inside these cards */
#view-share #card-import .btn,
#view-share #card-export .btn {
  min-width: 0; /* Allow buttons to fit the grid cell */
  width: 100%; /* Make them fill their cell */
  margin: 0; /* Reset any rogue margins */
}

/* 3. Ensure the Share card (which is fine) keeps its layout */
#view-share #card-share .row {
  display: flex !important;
  flex-wrap: wrap !important;
}
/* === END FIX === */
/* === Compact & Solid Share View === */

/* 1. Container: Center content and limit width for a 'solid' look on large screens */
#view-share {
    padding: 16px !important;
    height: 100%;
    overflow-y: auto; /* Scroll only if absolutely necessary on very small screens */
    box-sizing: border-box;
}

/* 2. Main Grid Layout: 3 columns on Desktop, 1 on Mobile */
#view-share .cards {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important; /* Force 3 equal columns */
    gap: 12px !important;
    max-width: 1200px;
    margin: 0 auto;
    align-items: stretch; /* Make all cards same height */
}

@media (max-width: 850px) {
    #view-share .cards {
        grid-template-columns: 1fr !important; /* Stack on tablets/mobile */
        gap: 16px !important;
    }
}

/* 3. Card Styling: Tighter padding, solid look */
#view-share .card {
    padding: 16px !important;
    gap: 12px !important;
    display: flex;
    flex-direction: column;
    background: var(--card);     /* Ensure solid background color */
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
    height: 100%; /* Fill grid height */
}

/* 4. Headings: Compact and clear */
#view-share .card h3 {
    margin: 0 0 4px 0 !important;
    font-size: 1.15rem !important;
    border-bottom: 2px solid color-mix(in srgb, var(--brand) 30%, transparent);
    padding-bottom: 8px;
    color: var(--brand);
}

/* 5. Inner Button Grids (Import/Export): Uniform 2-column grid for buttons */
/* This is key for the "solid" look - aligned buttons instead of random wrapping */
#view-share #card-import .row,
#view-share #card-export .row {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important; /* 2 buttons per row always */
    gap: 10px !important;
    margin: 0 !important; /* Remove default row margins */
    flex-grow: 1; /* Let it fill space */
    align-content: start;
}

/* 6. Share Card Specifics: Stack controls vertically for solidity */
#view-share #card-share .row {
    display: flex !important;
    flex-direction: column !important; /* Stack elements */
    gap: 12px !important;
    margin: 0 !important;
}

/* 7. Control Sizing: Uniform height and width for a clean look */
#view-share .btn,
#view-share .input,
#view-share select {
    height: 40px !important;         /* Fixed, compact height */
    min-height: 40px !important;
    min-width: 0 !important;         /* Allow shrinking to grid cell */
    width: 100% !important;          /* Full width of their grid cell/container */
    margin: 0 !important;
    padding: 0 12px !important;
    font-size: 0.95rem !important;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

/* Special tweak for labels in Share card to sit nicely above inputs if needed,
   or just be compact next to them if we want row-based (let's stick to column for solidity on small width) */
#view-share #card-share label.label {
    margin-bottom: -8px; /* Pull label closer to its input */
    font-size: 0.9rem;
    color: var(--muted);
}

/* 8. Mobile Specific Tweaks for "One Screen" feel */
@media (max-width: 600px) {
    #view-share {
        padding: 12px !important;
    }
    /* On very small screens, make import/export buttons full width for easier tapping,
       OR keep them 2-col if vertical space is more important.
       Let's keep 2-col to save vertical space as requested. */
    #view-share .card {
        padding: 12px !important;
    }
}

/* === RADICAL COMPACT DASHBOARD FOR SHARE TAB === */

/* 1. LOCK THE CONTAINER NO MATTER WHAT */
#view-share[data-active="1"] {
    display: flex !important;
    flex-direction: column !important;
    padding: 8px !important;               /* Minimal padding around edge */
    height: calc(100dvh - 60px) !important; /* Force it to exactly fill screen minus header */
    max-height: 100% !important;
    overflow: hidden !important;           /* Ban scrolling globally for this view */
    box-sizing: border-box !important;
}

/* 2. DASHBOARD GRID LAYOUT */
#view-share .cards {
    display: grid !important;
    /* Desktop: 3 equal columns side-by-side */
    grid-template-columns: 1fr 1fr 1fr !important;
    grid-template-rows: 1fr !important;    /* One single row that stretches to fill height */
    gap: 8px !important;                   /* Tiny gap between panels */
    height: 100% !important;
    margin: 0 !important;
}

/* 3. PANEL (CARD) STYLING - SOLID LOOK */
#view-share .card {
    margin: 0 !important;
    padding: 8px 8px 0 8px !important;    /* Very tight padding inside */
    border: 2px solid var(--border) !important; /* Thicker border for "solid" feel */
    box-shadow: none !important;           /* Flat look saves space */
    background: var(--bg) !important;      /* Slightly different background if possible to look like a 'slot' */
    display: flex !important;
    flex-direction: column !important;
    min-height: 0 !important;              /* Crucial for nested scrolling if absolutely needed */
    overflow: hidden !important;           /* Never let card itself scroll nicely, force fit */
}

/* 4. COMPACT HEADERS */
#view-share .card h3 {
    font-size: 0.95rem !important;
    text-transform: uppercase !important;
    letter-spacing: 1px !important;
    text-align: center !important;
    opacity: 0.7 !important;
    margin: 0 0 8px 0 !important;
    padding-bottom: 4px !important;
    border-bottom: 1px solid var(--border) !important;
    flex-shrink: 0 !important;
}

/* 5. ULTRA-COMPACT BUTTON GRIDS (Import/Export) */
#view-share #card-import .row,
#view-share #card-export .row {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important; /* Always 2 columns of buttons */
    grid-auto-rows: min-content !important;    /* Rows only as tall as needed */
    gap: 6px !important;                       /* Tiny gap between buttons */
    margin: 0 !important;
    padding: 0 !important;
    align-content: start !important;           /* Pack buttons to the top */
    overflow-y: auto !important;               /* Allow internal scroll only if absolutely desperate */
}

/* 6. SHARE PANEL - VERTICAL STACK */
#view-share #card-share .row {
    display: flex !important;
    flex-direction: column !important;
    gap: 6px !important;
    margin: 0 !important;
}

/* 7. TINY CONTROLS (Buttons & Inputs) */
#view-share .btn,
#view-share .input,
#view-share select {
    height: 34px !important;         /* Drastically reduced height */
    min-height: 34px !important;
    font-size: 0.85rem !important;   /* Smaller text to fit */
    padding: 0 4px !important;
    margin: 0 !important;
    width: 100% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}
/* Hide file inputs completely to save space, they are triggered by buttons anyway */
#view-share input[type="file"] {
    display: none !important;
}
#view-share label.label {
    font-size: 0.8rem !important;
    margin-bottom: -4px !important;
    opacity: 0.8 !important;
}


/* === MOBILE PORTRAIT RE-LAYOUT (The real challenge for 1 screen) === */
@media (max-width: 768px) {
    #view-share {
        height: auto !important;      /* On mobile allow auto height to avoid squashing too much */
        min-height: calc(100dvh - 70px) !important;
        padding: 6px !important;
        overflow-y: auto !important;  /* Allow scroll on mobile if it really doesn't fit */
    }

    #view-share .cards {
        /* Switch to a dense vertical stack, or a 2x2 grid */
        grid-template-columns: 1fr 1fr !important;
        grid-template-rows: auto auto !important; /* Let heights fit content */
        gap: 6px !important;
        display: grid !important;
        height: auto !important;
    }

    /* Make the Share card take full width at the bottom */
    #view-share #card-share {
        grid-column: 1 / -1 !important; /* Span both columns */
    }
    
    /* Ensure buttons are still tap-able on mobile */
    #view-share .btn,
    #view-share .input,
    #view-share select {
        height: 40px !important; /* Slightly larger on mobile for touch */
        font-size: 0.9rem !important;
    }

    /* If Import/Export have too many buttons for half-width, 
       uncomment below to stack EVERYTHING vertically on very small screens */
    /*
    @media (max-width: 400px) {
         #view-share .cards { grid-template-columns: 1fr !important; }
         #view-share #card-share { grid-column: auto !important; }
    }
    */
}
/* =========================================
   תיקונים אגרסיביים למובייל (FLYMILY Mobile Fixes V2)
   ========================================= */

/* --- תיקון 1: מסך הבית (רשימת נסיעות) על מסך מלא --- */
@media (max-width: 900px) {
    /* דורס את הגדרת הגובה 40vh שקיימת ב-CSS המקורי לסרגל צד במובייל */
    body .container.home-mode .sidebar {
        height: auto !important;
        min-height: 100% !important;
        max-height: none !important;
        flex: 1 1 auto !important;
        width: 100% !important;
        order: unset !important;
        display: block !important;
    }

    /* מעלים לחלוטין את אזור התוכן במסך הבית במובייל */
    body .container.home-mode .content {
        display: none !important;
    }
    
    /* מכריח את הקונטיינר לתפוס את כל הגובה הזמין פחות ההדר */
    body .container.home-mode {
        display: flex !important;
        flex-direction: column !important;
        height: calc(100dvh - 57px) !important;
        grid-template-columns: 1fr !important;
        grid-template-rows: 1fr !important;
    }
}

/* --- תיקון 2: סידור מחדש של לשונית "נתוני נסיעה" במסכים קטנים --- */
@media (max-width: 600px) {
    /* הופך את כל השורות בטאב הזה לטורים אנכיים */
    #view-meta .card .row,
    #view-meta .date-row,
    #view-meta .dest-row,
    #view-meta .budget-row,
    #view-meta .budget-actions-row {
        display: flex !important;
        flex-direction: column !important;
        width: 100% !important;
        gap: 12px !important; /* ריווח אחיד בין כל האלמנטים */
        margin: 0 !important;
    }
    
    /* ריווח נוסף בין בלוקים */
    #view-meta .row + .row,
    #view-meta .budget-block {
        margin-top: 20px !important;
    }

    /* מתיחת כל שדות הקלט, התוויות והכפתורים לרוחב מלא */
    #view-meta .input,
    #view-meta select,
    #view-meta label,
    #view-meta .btn,
    #view-meta .people-input {
        width: 100% !important;
        max-width: none !important;
        box-sizing: border-box !important;
    }
    
    /* תיקון ספציפי לכפתור המפה שיהיה בגובה אחיד לשאר השדות */
    #view-meta .map-btn {
        margin-top: 0 !important;
        height: 44px !important;
    }

    /* סידור הצ'יפים (סוגי טיול) שיראו נורמלי גם בטור */
    #view-meta .multi-types {
        width: 100% !important;
        margin-top: 10px !important;
    }
    #view-meta .chips {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 8px !important;
    }
    #view-meta .chips .chip {
        flex: 1 0 auto !important; /* נותן לצ'יפים לגדול אם יש מקום */
        text-align: center !important;
        padding: 10px !important;
    }
}
/* === תיקון אחידות צבע טקסט במובייל === */
@media (max-width: 480px) {
  /* וידוא שצבע הטקסט הבסיסי זהה למחשב (ללא שקיפות) */
  #view-expenses .expenses-table.stacked td.notes,
  #view-journal .expenses-table td.notes,
  .journal-card .text {
      color: var(--ink) !important;
      opacity: 1 !important;
  }
  
  /* וידוא שטקסט שנצבע ע"י המשתמש (RTF) בולט ולא מקבל שקיפות */
  .cell.notes span[style*="color"],
  .journal-card .text span[style*="color"] {
      opacity: 1 !important;
  }
}

/* === רענון עיצוב מקצועי (בהשראת Tello) === */

/* 1. פלטת צבעים ורדיוסים אחידים */
:root {
  /* הגדרת צבעי המותג החדשים */
  --tello-blue: #0077ff;
  --tello-green: #00b74a;
  --tello-green-dark: #00913c;
  --tello-light-blue: #8bd3ff;
  --tello-light-green: #06d6a0;

  /* רדיוס גבולות אחיד */
  --radius: 10px;
  --radius-lg: 12px;
}

/* 2. עדכון פלטת צבעים (מצב בהיר) */
[data-theme="light"] {
  --brand: var(--tello-blue);    /* כחול ראשי (כמו בתמונה) */
  --accent: var(--tello-green);   /* ירוק לפעולות מרכזיות (כמו הכפתור בתמונה) */
  --ok: var(--tello-green);       /* ירוק להצלחה (אחידות) */
  --ink: #0e1116;                /* טקסט כהה וברור */
  --muted: #415266;              /* טקסט משני */
  --card: #ffffff;
  --bg: #f7f8fb;                 /* רקע כללי נקי */
  --border: #dde2e8;            /* גבול מעט יותר ברור */
  --shadow: 0 4px 12px rgba(0, 119, 255, 0.08); /* הצללה קלה בגוון כחול */
}

/* 3. עדכון פלטת צבעים (מצב כהה - מותאם) */
[data-theme="dark"] {
  --brand: var(--tello-light-blue);   /* כחול בהיר למצב כהה */
  --accent: var(--tello-light-green); /* ירוק בהיר למצב כהה */
  --ok: var(--tello-light-green);     /* אחידות */
  --bg: #0a1018;                   /* כחול עמוק יותר */
  --card: #121a24;                  /* כחול עמוק יותר */
  --border: #273142;
  --shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
}

/* 4. עיצוב ה-Header מחדש */
body header {
  background: var(--brand); /* רקע כחול מלא */
  color: #ffffff;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

header .brand,
header .brand-text {
  color: #ffffff;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1); /* צל קל ללוגו */
}

/* כפתורים רגילים בהדר (כמו "מצב כהה") */
header button, 
header .btn {
  color: #ffffff;
  /* שונה: גבול לבן מלא יותר וצורה עגולה */
  border: 1px solid rgba(255, 255, 255, 0.8);
  background: transparent;
  transition: background 0.2s ease, color 0.2s ease;
  border-radius: 999px; /* שינוי לרדיוס גלולה */
  padding: 8px 16px;   /* ריווח פנימי רחב יותר */
}

header button:hover, 
header .btn:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: #ffffff;
}

/* כפתור כניסה (ראשי) בהדר */
header .btn.primary {
  background: #ffffff;
  color: var(--tello-blue);
  border: none;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  /* border-radius and padding יורשים מהכלל שלמעלה */
}

header .btn.primary:hover {
  background: #f0f4f8;
  color: var(--tello-blue);
}

/* === הוספה חדשה: עיצוב כפתור התנתקות (.danger) בהדר === */
/* זה דורס את העיצוב האדום הכללי של .btn.danger רק בהדר */
header .btn.danger {
  background: #ffffff !important;
  color: #000000 !important; /* טקסט שחור כמו בתמונה */
  border: none !important;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

header .btn.danger:hover {
  background: #f0f4f8 !important;
  color: #000000 !important;
}
/* === סוף הוספה === */

/* תג משתמש ורשימה נפתחת */
header #userBadge {
  border-color: rgba(255, 255, 255, 0.8); /* התאמה לגבול הלבן */
  /* border-radius and padding יורשים מהכלל שלמעלה */
}
header #userBadge span {
  color: #ffffff;
}
header #userMenuList {
  background: var(--card); /* רקע לבן/כהה רגיל */
  color: var(--ink);
}
header #userMenuList button {
  color: var(--ink); /* צבע טקסט רגיל */
  border: none;
}
header #userMenuList button:hover {
  background: var(--bg);
}

/* 5. מסגרות אחידות (Border Radius) ופוקוס */
.btn,
.input, 
select, 
textarea,
.menu-btn,
.login-card {
  border-radius: var(--radius); /* 10px */
}

.trip-card,
.card,
.menu-list,
.leaflet-container,
dialog.modal,
.toast {
  border-radius: var(--radius-lg, 12px); /* 12px לכרטיסים ומודלים */
}

.trip-row {
  border-radius: var(--radius); /* 10px */
}

/* עיצוב פוקוס מודרני ואחיד */
.input:focus, 
select:focus, 
textarea:focus,
.btn:focus-visible,
button:focus-visible {
  outline: none;
  border-color: var(--brand);
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--brand) 25%, transparent);
}

/* 6. עיצוב כפתורים מחדש (גוף העמוד) */

/* כפתור ברירת מחדל (אפור, כמו "מיין", "ביטול") */
.btn {
  background: var(--card);
  color: var(--muted);
  border: 1px solid var(--border);
  font-weight: 500;
  transition: background 0.2s ease, border-color 0.2s ease;
}

.btn:hover {
  background: var(--bg);
  border-color: var(--muted);
  color: var(--ink);
}

/* כפתור ראשי (ירוק, כמו "שמור", "הוסף") */
.btn.primary {
  background: var(--accent); /* שימוש בירוק שהגדרנו */
  color: #ffffff;
  border: none;
  font-weight: 600;
  text-shadow: 0 1px 1px rgba(0,0,0,0.1);
}

.btn.primary:hover {
  background: var(--tello-green-dark, #00913c);
  filter: brightness(1.1); /* גיבוי אם המשתנה לא קיים */
  color: #ffffff;
}

.btn:disabled {
  background: var(--border);
  border-color: var(--border);
  color: var(--muted);
  opacity: 0.7;
}

/* כפתור סכנה (אדום) */
.btn.danger {
  background: var(--card);
  color: var(--danger);
  border: 1px solid var(--danger);
}
.btn.danger:hover {
  background: var(--danger);
  color: #ffffff;
}

/* כפתור פעיל (טאבים, בחירת תצוגה) - כחול */
.tabs button.active,
.list-actions .btn.active {
  background: var(--brand); /* שימוש בכחול שהגדרנו */
  color: #ffffff;
  border-color: var(--brand);
  font-weight: 600;
  outline: none;
  box-shadow: none;
}

.tabs button {
  border-bottom: 1px solid var(--border);
}
.tabs button.active {
  border-bottom: 1px solid var(--brand);
}

/* 7. ליטוש כללי */
h1, h2, h3 {
  color: var(--ink);
  font-weight: 600; /* הדגשת כותרות */
}

/* כרטיסים וכרטיסיות נסיעה */
.card, .trip-card, .trip-row {
   box-shadow: var(--shadow); /* שימוש בצל המותאם */
}

/* לינקים מודגשים */
a {
  color: var(--brand);
  text-decoration: none;
  font-weight: 500;
}
a:hover {
  text-decoration: underline;
}

/*
נמחק מכאן חוק שהסתיר את כפתור מצב כהה
*/

/* תיקון עיצוב כפתור התנתקות (לפי התמונה)
  ודא שכפתור ההתנתקות (שהופך מ"התחברות")
  מקבל את עיצוב הגלולה הלבנה.
*/
header #btnLogin.danger {
  background: #ffffff !important;
  color: #000000 !important; /* טקסט שחור כמו בתמונה */
  border: none !important;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  border-radius: 999px !important; /* ודא שהוא גלולה */
  padding: 8px 16px !important;
}

/* תיקון עיצוב כפתור התנתקות (הכפתור הקבוע) 
  כדי שיראה כמו שאר הכפתורים בהדר
*/
#logoutBtn {
  position: static !important; /* הסר מיקום קבוע */
  order: 21; /* הצב אותו אחרי האימייל */
  background: #ffffff !important;
  color: #000000 !important;
  border: none !important;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  border-radius: 999px !important;
  padding: 8px 16px !important;
  font-size: inherit !important;
  line-height: inherit !important;
  height: auto;
}
#logoutBtn:hover {
  background: #f0f4f8 !important;
  color: #000000 !important;
}
/* === Overview "הצג הכל" merged list === */
#view-overview .list-actions{
  display:flex;
  justify-content:flex-end;
  margin-bottom:10px;
}
#view-overview .expenses-table-container{
  overflow-x:auto;
}
#view-overview .expenses-table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  direction:rtl;
}
#view-overview .expenses-table td{
  border-bottom:1px solid var(--border);
  padding:10px;
  text-align:right;
}
#view-overview .list-actions{
  display:flex;
  justify-content:flex-start;
  margin-bottom:12px;
}

#view-overview #btnAllSort.sort-icon-btn{
  width:auto;
  min-width:40px;
  padding:6px 10px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:1rem;
}

#view-overview #btnAllSort .sort-icon{
  display:inline-block;
  transition:transform .15s ease-in-out;
}

#view-overview #btnAllSort.asc .sort-icon{
  transform:rotate(180deg);
}

#view-overview .expenses-table tr.exp-item[data-kind="expense"]:has(td.header) .cell.header{
  background:color-mix(in oklab, var(--brand) 10%, var(--card));
}

#view-overview .expenses-table tr.exp-item[data-kind="journal"]:has(td.header) .cell.header{
  background:color-mix(in oklab, var(--accent) 10%, var(--card));
}

#view-overview .expenses-table .cell.notes{
  background:var(--bg);
}

#view-overview .expenses-table .small-loc{
  font-size:0.8rem;
}



/* === Overview tab ("הצג הכל") color coding === */
#view-overview .expenses-table tr.exp-item[data-kind="expense"] .cell.header {
  background: rgba(255, 120, 120, 0.20) !important; /* light red */
}
#view-overview .expenses-table tr.exp-item[data-kind="journal"] .cell.header {
  background: rgba(140, 255, 140, 0.20) !important; /* light green */
}

/* Mobile layout for Overview: keep simple table on mobile */
@media (max-width: 720px){
  /* Use regular table rows so nothing breaks visually */
  #view-overview .expenses-table{
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  #view-overview .expenses-table tr.exp-item{
    display: table-row;
    margin: 0;
    padding: 0;
  }

  #view-overview .expenses-table td.cell{
    padding: 8px;
    font-size: 0.9rem;
    box-sizing: border-box;
  }

  /* Make notes span full width and breathe a bit */
  #view-overview .expenses-table td.notes{
    display: table-cell;
    padding-top: 6px;
    padding-bottom: 10px;
  }
}
/* Preserve line breaks in Overview */
#view-overview .cell.notes,
#view-overview td.notes,
#view-overview .expenses-table .cell.notes {
    white-space: break-spaces;
    word-break: break-word;
}

/* ======== Mobile-only compact headers for Expenses & Journal ======== */
@media (max-width: 480px){

  /* Shared */
  #view-expenses .expenses-table, 
  #view-journal .expenses-table { border-spacing:0; width:100%; }
  
  /* Base item styles */
  #view-expenses .expenses-table tr.exp-item,
  #view-journal .expenses-table tr.exp-item {
      display: grid; /* Use grid for both, but different templates */
      align-items: center;
      background: transparent; 
      padding: 0; 
      margin-bottom: 8px; /* Space between items */
      border-radius: 0; 
  }

  /* --- Expenses: Header Row (tr1) --- */
  #view-expenses .expenses-table.stacked tr.exp-item:has(td.header),
  #view-overview .expenses-table tr.exp-item[data-kind="expense"]:has(td.header) {
    grid-template-columns: 1fr 1fr auto;
    grid-template-areas: "date time menu"
                         "amount currency menu";
    gap: 0;
    /* Add the grey background to the header row itself */
    background: rgba(255, 120, 120, 0.20) !important;
    border-radius: 8px; /* Round the corners of the header block */
  }
  
  /* Cells inside the header row */
  #view-expenses .expenses-table.stacked tr.exp-item:has(td.header) td.cell {
      border: none;
      padding: .5rem .75rem;
      background: transparent !important; /* Cells are transparent, TR has color */
  }

  /* Area assignments for header cells */
  #view-expenses .expenses-table.stacked td.header.date{ grid-area:date; }
  #view-expenses .expenses-table.stacked td.header.time{ grid-area:time; }
  #view-expenses .expenses-table.stacked td.header.amount{ grid-area:amount; }
  #view-expenses .expenses-table.stacked td.header.currency{ grid-area:currency; }
  #view-expenses .expenses-table.stacked td.menu-cell{ grid-area:menu; text-align:left; padding: .5rem 0 .5rem .75rem; }
  #view-expenses .expenses-table.stacked td.header.category{ display:none; }

  /* --- Expenses: Notes Row (tr4) --- */
  #view-expenses .expenses-table.stacked tr.exp-item:has(td.notes),
  #view-overview .expenses-table tr.exp-item[data-kind="expense"]:has(td.notes) {
      display: block; /* Revert to block display for the notes row */
      margin-top: -4px; /* Pull it closer to the header row */
      margin-bottom: 8px; /* Keep space to next item */
  }
  
  #view-expenses .expenses-table.stacked td.notes {
      grid-column: 1 / -1;
      padding: .5rem .75rem;
      background: transparent; /* Notes cell is transparent */
      border: none; /* <-- הוסר כל הקו (עליון ותחתון) */
   }

  /* טיפוגרפיה */
  #view-expenses .expenses-table.stacked .amount .amt-main{ font-weight:700; }
  #view-expenses .expenses-table.stacked .currency .ils-total{ font-weight:700; }
  #view-expenses .expenses-table.stacked .amt-sub{ font-size:.85em; opacity:.8; }

  /* --- Journal: Header Row (tr1) --- */
  #view-journal .expenses-table tr.exp-item:has(td.header),
  #view-overview .expenses-table tr.exp-item[data-kind="journal"]:has(td.header){ 
    grid-template-columns: 1fr 1fr auto;
    grid-template-areas: "date time menu"
                         "location location menu";
    gap: 0; 
    background: rgba(140, 255, 140, 0.20) !important;
    padding: 0;
    margin-bottom: 0; /* No margin-bottom, notes row will handle spacing */
    border-radius: 8px;
  }
  
  /* Cells inside journal header row */
  #view-journal .expenses-table tr.exp-item:has(td.header) td.cell {
      border:none;
      padding: .5rem .75rem;
      background: transparent !important;
  }
  
  #view-journal .expenses-table td.header.date{ grid-area:date; }
  #view-journal .expenses-table td.header.time{ grid-area:time; }
  #view-journal .expenses-table td.header.location{ grid-area:location; }
  #view-journal .expenses-table td.menu-cell{ grid-area:menu; text-align:left; padding: .5rem 0 .5rem .75rem; /* Adjust menu padding */ }

  /* --- Journal: Notes Row (tr4) --- */
  #view-journal .expenses-table tr.exp-item:has(td.notes),
  #view-overview .expenses-table tr.exp-item[data-kind="journal"]:has(td.notes) {
      display: block; /* Revert to block display */
      margin-top: -4px; /* Pull it closer */
      margin-bottom: 8px; /* Space to next item */
  }
  
  #view-journal .expenses-table td.notes {
      grid-column: 1 / -1;
      padding: .5rem .75rem;
      background: transparent; 
      border: none; /* <-- הוסר כל הקו (עליון ותחתון) */
  }


  /* הסתרת תאי בחירה במובייל ברירת מחדל (כשאין מצב בחירה) */
  #view-journal .expenses-table td.select-cell,
  #view-expenses .expenses-table td.select-cell{ display:none; }

  /* --- Trip meta (נתוני נסיעה): קריא ונוח --- */
  #view-meta .section .row,
  #view-meta .budget-row,
  #view-meta .budget-actions-row{ display:grid; grid-template-columns: 1fr; gap:.6rem; }
  #view-meta .chips, #view-meta .pill-group, #view-meta .tag-row{ display:flex; flex-wrap:wrap; gap:.4rem; }
  #view-meta input, #view-meta select, #view-meta textarea{ width:100%; }
  #view-meta .budget-block{ padding:1rem; }
  #view-meta .budget-row{ grid-template-columns: repeat(2, 1fr); }
  #view-meta .budget-row label{ width:100%; }

}
/* GPX button + manager */
.btn-gpx{background:#0b5ed7;color:#fff;border-color:#084298}
.btn-gpx.active{background:#084298}
.gpx-panel{position:absolute;left:16px;top:90px;z-index:900;max-width:min(720px, calc(100% - 32px));background:#fff;border:1px solid #e5e7eb;border-radius:18px;box-shadow:0 12px 30px rgba(0,0,0,.15);padding:14px}
.gpx-panel .gpx-head{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
.gpx-panel .gpx-count{margin-inline-start:auto;color:#6b7280;font-weight:600}
.gpx-panel .gpx-list{display:flex;flex-direction:column;gap:10px;max-height:min(420px, calc(100vh - 240px));overflow:auto;padding-right:6px}
.gpx-panel .gpx-row{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;border-top:1px solid #eef2f7;padding-top:10px}
.gpx-panel .gpx-row:first-child{border-top:none;padding-top:0}
.gpx-panel .gpx-name{font-weight:700}
.gpx-panel .gpx-actions{display:flex;gap:8px}


/* Overview (הצג הכל) search + toggle */
.overview-actions{ gap:12px; align-items:center; flex-wrap:wrap; }
.overview-actions .search-input{flex:0 1 170px;min-width:160px;max-width:240px}
.overview-actions .hits{ min-width:64px; text-align:center; }
.overview-actions .nav-btn{ width:44px; padding-inline:0; }

#view-overview mark{
  background: #ffeb3b;
  color: inherit;
  padding: 0 2px;
  border-radius: 4px;
}
#view-overview mark.current-hit{
  outline: 3px solid rgba(33,150,243,0.75);
  outline-offset: 2px;
}

/* When collapsing in "הצג הכל" - keep the colored header rows visible and hide only details rows */
.all-collapsed #tblAllTimeline tr.exp-details{ display:none; }
/* Allow opening a single item while global state is collapsed */
.all-collapsed #tblAllTimeline tr.exp-details.force-open{ display:table-row; }
.all-collapsed #tblAllTimeline tr.exp-item.force-open{ box-shadow: inset 0 0 0 2px rgba(33,150,243,.25); }

/* ===============================
   SHARE VIEW — CLEAN / PROFESSIONAL
   =============================== */

/* kill legacy experimental layouts for share view */
#view-share .cards{ display:block !important; }
#view-share .cards.share-grid{ display:grid !important; grid-template-columns:repeat(3, minmax(260px, 1fr)); gap:16px; align-items:stretch; }
@media (max-width: 980px){
  #view-share .cards.share-grid{ grid-template-columns:repeat(2, minmax(260px, 1fr)); }
}
@media (max-width: 640px){
  #view-share .cards.share-grid{ grid-template-columns:1fr; }
}

#view-share .share-page{ max-width:1120px; margin:0 auto; padding:18px 10px; }
#view-share .share-head{ margin-bottom:14px; }
#view-share .share-head h2{ margin:0; font-size:18px; font-weight:700; }
#view-share .share-head .muted{ margin:4px 0 0 0; }

#view-share .share-card{
  background: var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  box-shadow: var(--shadow);
  overflow: visible !important;
}

#view-share .share-card-head{ display:flex; align-items:center; justify-content:space-between; padding-bottom:10px; border-bottom:1px solid var(--border); margin-bottom:12px; }
#view-share .share-card-head h3{ margin:0; font-size:15px; font-weight:700; }
#view-share .share-badge{ font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); background: rgba(0,0,0,0.03); }

#view-share .share-actions{ display:grid; grid-template-columns:1fr; gap:10px; }
#view-share .share-actions button.btn{ width:100%; justify-content:center; height:44px; border-radius:10px; }
#view-share .share-actions-wide{ grid-template-columns:1fr 1fr; }
@media (max-width: 640px){
  #view-share .share-actions-wide{ grid-template-columns:1fr; }
}

#view-share .share-inline{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-top:10px;
  padding-top:10px;
  border-top:1px solid var(--border);
}
#view-share .share-inline .label{ margin:0; font-weight:600; }
#view-share #shareDuration.input{ width:160px; height:44px; border-radius:10px; }

/* make the whole section breathe and remove “inner scrollbars” look */
#view-share .tabview{ padding-top:6px; }
#view-share .card, #view-share .share-card{ scrollbar-gutter: auto; }

#view-share .share-grid{ display:grid; grid-template-columns:repeat(3, minmax(280px, 1fr)); gap:16px; align-items:stretch; }
@media (max-width: 1024px){
  #view-share .share-grid{ grid-template-columns:repeat(2, minmax(280px, 1fr)); }
}
@media (max-width: 720px){
  #view-share .share-grid{ grid-template-columns:1fr; }
}

/* buttons look consistent */
#view-share .btn{ box-shadow:none; }
#view-share .btn.btn-danger{ border-radius:10px; }
#view-share .btn.btn-outline{ border-radius:10px; }

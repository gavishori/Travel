:root{
  --bg:#0f1115; --card:#151922; --ink:#e9eef4; --muted:#9fb0c0; --brand:#8bd3ff; --accent:#ffd166; --ok:#06d6a0; --danger:#ef476f;
  --border:#273142; --shadow:0 10px 30px rgba(0,0,0,.25);
}
[data-theme="light"]{
  --bg:#f7f8fb; --card:#ffffff; --ink:#0e1116; --muted:#415266; --brand:#0077ff; --accent:#faad14; --ok:#089e71; --danger:#d9363e; --border:#e6e9ef; --shadow:0 10px 20px rgba(0,0,0,.06);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:Rubik,system-ui,-apple-system,Segoe UI,Roboto,Arial;overflow:hidden;direction:rtl}
a{color:var(--brand);text-decoration:none}
.app{display:grid;grid-template-rows:auto 1fr}
header{display:flex;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid var(--border);background:var(--card);position:sticky;top:0;z-index:5}
header .brand{font-weight:700;letter-spacing:.5px}
header .spacer{flex:1}
header button, .btn{background:transparent;border:1px solid var(--border);color:var(--ink);padding:8px 12px;border-radius:12px;cursor:pointer}
.btn.primary{border-color:var(--brand);background:color-mix(in oklab, var(--brand) 20%, transparent)}
.btn.danger{border-color:var(--danger);color:var(--danger)}
.btn:disabled{opacity:.5;cursor:not-allowed}

.container{display:grid;grid-template-columns:320px 1fr;height:calc(100vh - 56px)}
.sidebar{border-inline-start:1px solid var(--border);background:var(--card);padding:16px;overflow:auto}
.content{padding:16px;overflow:auto}

.section-title{display:flex;align-items:center;gap:10px;margin:8px 0 12px}
.input, select, textarea{width:100%;background:transparent;border:1px solid var(--border);color:var(--ink);padding:10px 12px;border-radius:10px;outline:none}
textarea{min-height:80px}
.row{display:flex;gap:10px}
.row > *{flex:1}

.list-actions{display:flex;gap:8px;align-items:center;margin-bottom:10px}
.tabs{display:flex;gap:8px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg);padding-bottom:8px;z-index:4}
.tabs button{padding:10px 12px;border-radius:12px 12px 0 0;border:1px solid var(--border);border-bottom:none;background:var(--card)}
.tabs button.active{outline:2px solid color-mix(in oklab, var(--brand) 40%, transparent)}

.trip-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
.list{display:flex;flex-direction:column;gap:8px}
.trip-row{display:grid;grid-template-columns:1fr auto;gap:8px;padding:10px;border:1px solid var(--border);border-radius:12px;background:var(--card)}
.muted{color:var(--muted)}
.pill{border:1px solid var(--border);padding:4px 8px;border-radius:999px;font-size:.85rem}

.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:12px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
table{width:100%;border-collapse:separate;border-spacing:0}
th,td{border-bottom:1px solid var(--border);padding:10px;text-align:right}
th{position:sticky;top:0;background:var(--card)}

.menu{position:relative}
.menu-btn{border:1px solid var(--border);background:transparent;border-radius:10px;padding:6px 10px}
.menu-list{position:absolute;left:0;top:36px;background:var(--card);border:1px solid var(--border);border-radius:12px;min-width:160px;display:none;z-index:3}
.menu-list.open{display:block}
.menu-list button{display:block;width:100%;padding:10px;background:transparent;border:none;text-align:right}

.leaflet-container{height:420px;border-radius:16px;border:1px solid var(--border)}
.map-toolbar{position:absolute;inset-inline-start:12px;inset-block-start:12px;display:flex;gap:8px;z-index:400}

dialog.modal{border:1px solid var(--border);border-radius:16px;background:var(--card);color:var(--ink);padding:0;max-width:420px;width:90%}
.modal header{padding:12px 16px;border-bottom:1px solid var(--border);background:transparent}
.modal .body{padding:14px 16px}
.modal .footer{display:flex;gap:8px;justify-content:flex-start;padding:12px 16px;border-top:1px solid var(--border)}

.toast{position:fixed;inset-inline-end:16px;inset-block-end:16px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px 14px;box-shadow:var(--shadow);display:none}
.toast.show{display:block}

/* Responsive */
@media (max-width: 900px){
  .container{grid-template-columns:1fr}
  .sidebar{order:2;height:40vh}
  .content{order:1;height:auto}
  body{overflow:auto}
}

/* Modes: home (all trips) vs trip (focus one) */
.container.home-mode{ grid-template-columns: 1fr; }
.container.home-mode .content{ display: none; }
.container.home-mode .sidebar{ display: block; width: 100%; max-width: 1100px; margin: 0 auto; }
.container.home-mode .sidebar .section-title h2{ font-size: 1.6rem; }
.container.home-mode #tripList.grid{ grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); }

.container.trip-mode{ grid-template-columns: 1fr; }
.container.trip-mode .sidebar{ display: none; }
.container.trip-mode .content{ display: block; }

.brand-text{font-weight:700;letter-spacing:.5px}


/* Centered login screen */
.login-screen{display:grid;place-items:center;height:calc(100vh - 56px);padding:20px}
.login-card{width:min(420px,92vw);background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:20px;display:flex;flex-direction:column;gap:10px;align-items:flex-start}
.login-card h1{font-size:1.6rem;margin:.2rem 0 .4rem}
.login-card .input{width:100%}

/* user badge */
#userBadge{padding:6px 10px;border:1px solid var(--border);border-radius:999px}


/* === Budget Bar === */
.budget-bar{
  display:flex; align-items:center; gap:16px;
  border:1px solid var(--border); border-radius:22px; padding:12px 14px; background:var(--card);
}
.budget-bar .bar-actions{display:flex; gap:10px}
.budget-bar .btn.subtle{border:1px solid var(--border); background:transparent; border-radius:12px; padding:6px 12px}
.budget-bar .bar-cols{display:flex; gap:28px; margin-inline-start:auto}
.budget-bar .col{display:flex; align-items:center; gap:8px; min-width:120px; justify-content:flex-start}
.budget-bar .lbl{color:var(--muted); font-size:14px}
.budget-bar .val{font-size:16px}
.budget-bar .val.bold{font-weight:700}
.budget-bar .val.neg{color:var(--danger)}
.budget-bar .badge{border:1px solid var(--border); border-radius:12px; padding:6px 12px; background:var(--card)}

/* Updated "Meta" tab design */
#view-meta .card {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 16px;
}

#view-meta .card .row.dest-row {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px;
  align-items: end;
}
/* New style for the map button to match the destination input field */
#view-meta .btn.map-btn {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 12px;
  height: 44px; /* Matches the height of the input field */
}


/* New layout for date, people, and trip types */
#view-meta .date-row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  gap: 10px;
  align-items: flex-end;
}
#view-meta .date-row label {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
#view-meta .date-row label:has(#metaStart), #view-meta .date-row label:has(#metaEnd) {
    grid-column: span 1;
    width: 100%;
}
#view-meta .date-row .people-input {
  grid-column: 3 / 4;
}
#view-meta .date-row .multi-types {
  grid-column: 4 / 5;
  display: flex;
  flex-direction: column;
  gap: 4px;
}
#view-meta .date-row .multi-types .lbl {
  font-size: 1em;
}
#view-meta .date-row .chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
#view-meta .date-row .chips .chip {
  padding: 6px 10px;
  flex-shrink: 0;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 999px;
  cursor: pointer;
}
#view-meta .date-row .chips .chip.active {
  background: var(--brand);
  color: var(--ink);
}

/* Budget block */
#view-meta .budget-block {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 12px;
  border: 1px dashed var(--border);
  border-radius: 12px;
}
#view-meta .budget-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
  gap: 8px;
}
#view-meta .budget-actions-row {
  display: flex;
  justify-content: flex-start;
  gap: 10px;
}
#view-meta .rates-line {
  display: none; /* Hide exchange rates section */
}

#view-meta .row:has(#btnSaveMeta) {
  display: flex;
  justify-content: flex-start;
  gap: 8px;
}
/* Journal modal helper buttons */
#journalModal .btn.outlined{ background:var(--card); border:1px solid var(--border); color:var(--ink); height:44px; border-radius:10px; padding:10px 12px; }
#journalModal label{ display:flex; flex-direction:column; gap:6px; }
#journalModal .body > *:not(.row) {
  margin-bottom: 12px;
}
#journalModal .body .fields-row {
  display: flex;
  gap: 10px;
}

/* Make #jrPlace look like the buttons and align spacing */
#journalModal #jrPlace.input{ height:44px; border:1px solid var(--border); border-radius:10px; padding:10px 12px; }
#journalModal .fields-row{ display:flex; gap:10px; }


/* Expense modal helper buttons + align */
#expenseModal .btn.outlined{ background:var(--card); border:1px solid var(--border); color:var(--ink); height:44px; border-radius:10px; padding:10px 12px; }
#expenseModal .row{ display:flex; gap:10px; }
#expenseModal .row > * { flex: 1; }
#expenseModal .body > label:not(:last-of-type), #expenseModal .body > .row:not(:last-of-type){
  margin-bottom: 12px;
}
#expenseModal .fields-row{ display:flex; gap:10px; }
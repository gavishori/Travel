<!doctype html>
<html dir="rtl" lang="he">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>FLYMILY – הנסיעות שלי</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- Favicon to avoid 404 -->
  <link rel="icon" sizes="any" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%231a1f2b'/%3E%3Cpath d='M20 44 L44 20 L32 32 Z' fill='%236aa9ff'/%3E%3Ccircle cx='32' cy='32' r='4' fill='%23ffffff'/%3E%3C/svg%3E">

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Splash / Auth -->
  <div id="splash">
    <div class="card splash-card">
      <h1>הנסיעות שלי</h1>
      <p class="muted">נהל טיולים, הוצאות, יומן יומי ומפה — ב־RTL, מובייל, וללא באגים.</p>

      <!-- Clean single email/password form -->
      <form id="emailAuthForm" class="actions" onsubmit="return false" autocomplete="on" style="flex-wrap:wrap;gap:.5rem">
        <button type="button" id="togglePassBtn" class="btn ghost" aria-pressed="false" title="הצג/הסתר סיסמה">👁️ הצג</button>
        <input id="loginPassword" type="password" placeholder="סיסמה" required style="min-width:180px">
        <input id="loginEmail" type="email" placeholder="אימייל" required style="min-width:220px">
        <button id="signInBtn" class="btn primary" aria-label="כניסה/הרשמה">כניסה / הרשמה</button>
        <button type="button" id="continueLocalBtn" class="btn ghost" aria-label="המשך ללא התחברות">המשך ללא התחברות</button>
        <div id="authError" class="small" style="color:var(--danger);width:100%"></div>
      </form>

      <div style="display:flex;gap:.5rem;align-items:center;justify-content:space-between;width:100%;margin-top:.25rem">
        <label class="checkbox" style="gap:.35rem">
          <input id="rememberEmail" type="checkbox"> זכור את האימייל
        </label>
        <button type="button" id="forgotPasswordBtn" class="btn ghost" title="איפוס סיסמה">שכחתי סיסמה</button>
      </div>
    </div>
  </div>

  <!-- App -->
  <div id="app" hidden>
    <header class="appbar">
      <div class="brand"><span class="logo">🧭</span><span>הנסיעות שלי</span></div>
      <div class="app-actions">
        <button id="themeToggle" class="btn ghost" aria-label="מצב כהה/בהיר">כהה / בהיר</button>
        <button id="signOutBtn" class="btn ghost" aria-label="יציאה" title="יציאה" hidden>יציאה</button>
      </div>
    </header>
    <main id="views"></main>
  </div>

  <!-- Inject Firebase config with API key prompt fallback -->
  <script>
    (function(){
      window.firebaseConfig = {
        apiKey: localStorage.getItem('firebase.apiKey') || "PASTE_YOUR_API_KEY",
        authDomain: "travel-416ff.firebaseapp.com",
        projectId: "travel-416ff",
        storageBucket: "travel-416ff.appspot.com",
        messagingSenderId: "1075073511694",
        appId: "1:1075073511694:web:7876f492d18a702b09e75f",
        measurementId: "G-FT56H33X5J"
      };
      if(window.firebaseConfig.apiKey === "PASTE_YOUR_API_KEY"){
        try{
          var k = prompt('הדבק את ה‑API Key של Firebase (יישמר מקומית בדפדפן):');
          if(k){ localStorage.setItem('firebase.apiKey', k); window.firebaseConfig.apiKey = k; }
        }catch(_){}
      }
    })();
  </script>

  <script src="firebase.js"></script>
  <script src="script.js"></script>
</body>
</html>

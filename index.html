<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FLYMILY — מתכנן וניהול טיול</title>
  <link rel="icon" href="./logo.png" type="image/png">

  <!-- Soft palette & typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:FILL@0..1" rel="stylesheet" />

  <!-- Leaflet (maps) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <!-- Toastify -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

  <link rel="stylesheet" href="./style.css" />
</head>
<body data-theme="light">
  <!-- ===== Header ===== -->
  <header class="app-header">
    <div class="brand" id="brandHome">
      <img class="brand-logo" src="./logo.png" alt="FLYMILY logo" />
      <div class="brand-text">
        <div class="title">FLYMILY</div>
        <div class="subtitle">מתכנן וניהול טיולים</div>
      </div>
    </div>

    <div class="header-actions">
      <button id="btnAllTrips" class="chip hidden">
        <span class="material-symbols-rounded">arrow_back</span>
        כל הנסיעות
      </button>

      <button id="btnTheme" class="icon-btn" title="מצב כהה/בהיר">
        <span class="material-symbols-rounded" id="themeIcon">dark_mode</span>
      </button>

      <span id="userBadge" class="user-badge hidden"></span>

      <button id="btnLogin" class="primary" title="התחברות / הרשמה">
        <span class="material-symbols-rounded">login</span>
        התחברות / הרשמה
      </button>

      <button id="btnLogout" class="ghost hidden" title="התנתקות">
        <span class="material-symbols-rounded">logout</span>
        התנתקות
      </button>
    </div>
  </header>

    <!-- ===== Login Screen ===== -->
    <section class="login-screen" id="loginScreen">
      <div class="login-card card">
        <h1>FLYMILY</h1>
        <p class="muted">היכנסו כדי לנהל את הטיולים שלכם, להוסיף הוצאות, יומן ומפות.</p>

        <label>אימייל</label>
        <input id="lsEmail" type="email" placeholder="name@example.com" inputmode="email" autocomplete="username" />

        <label>סיסמה</label>
        <input id="lsPass" type="password" placeholder="••••••••" autocomplete="current-password" />

        <div class="btn-row">
          <button id="lsSignIn" class="primary">כניסה</button>
          <button id="lsSignUp" class="soft">הרשמה</button>
          <button id="lsReset" class="ghost">איפוס סיסמה</button>
        </div>
        <div id="lsError" class="error"></div>
      </div>
    </section>

    

  <!-- ===== Container (home-mode / trip-mode / read-only) ===== -->
  <div class="container home-mode hidden" id="appContainer"><!-- ===== Sidebar (Home Mode) ===== -->
    <aside class="sidebar" id="sidebar">
      <div class="sticky">
        <div class="section-title">
          <span class="material-symbols-rounded">explore</span>
          הנסיעות שלי
        </div>

        <div class="btn-row">
          <button id="btnNewTrip" class="primary">
            <span class="material-symbols-rounded">add</span> נסיעה חדשה
          </button>
        </div>

        <div class="search-wrap">
          <span class="material-symbols-rounded">search</span>
          <input id="searchTrips" type="text" placeholder="חיפוש יעד / משתתפים / סוג / הוצאות / יומן" />
        </div>

        <div class="view-controls">
          <button id="btnViewGrid" class="chip active">
            <span class="material-symbols-rounded">grid_view</span> גריד
          </button>
          <button id="btnViewList" class="chip">
            <span class="material-symbols-rounded">view_list</span> רשימה
          </button>
          <button id="btnSortTrips" class="chip">
            <span class="material-symbols-rounded">swap_vert</span> מיון לפי תאריך
          </button>
        </div>
      </div>

      <div id="tripList" class="trip-list grid"></div>
    </aside>

    <!-- ===== Main (Trip Mode) ===== -->
    <main class="main" id="mainArea">
      <!-- Tabs (Desktop) -->
      <div class="tabs desktop-only" id="tripTabs">
        <button class="tab active" data-view="view-overview">
          <span class="material-symbols-rounded">dashboard</span> הצג הכל
        </button>
        <button class="tab" data-view="view-meta">
          <span class="material-symbols-rounded">flag</span> נתוני נסיעה
        </button>
        <button class="tab" data-view="view-expenses">
          <span class="material-symbols-rounded">payments</span> הוצאות
        </button>
        <button class="tab" data-view="view-journal">
          <span class="material-symbols-rounded">event_note</span> יומן יומי
        </button>
        <button class="tab" data-view="view-map">
          <span class="material-symbols-rounded">map</span> מפה
        </button>
        <button class="tab" data-view="view-share">
          <span class="material-symbols-rounded">ios_share</span> ייבוא / ייצוא / שיתוף
        </button>
      </div>

      <!-- Accordions (Mobile) -->
      <div class="accordions mobile-only" id="mobileAccordions">
        <details data-view="view-overview" open>
          <summary><span class="material-symbols-rounded">dashboard</span> הצג הכל</summary>
          <div class="panel" id="view-overview"></div>
        </details>

        <details data-view="view-meta">
          <summary><span class="material-symbols-rounded">flag</span> נתוני נסיעה</summary>
          <div class="panel" id="view-meta"></div>
        </details>

        <details data-view="view-expenses">
          <summary><span class="material-symbols-rounded">payments</span> הוצאות</summary>
          <div class="panel" id="view-expenses"></div>
        </details>

        <details data-view="view-journal">
          <summary><span class="material-symbols-rounded">event_note</span> יומן יומי</summary>
          <div class="panel" id="view-journal"></div>
        </details>

        <details data-view="view-map">
          <summary><span class="material-symbols-rounded">map</span> מפה</summary>
          <div class="panel" id="view-map"></div>
        </details>

        <details data-view="view-share">
          <summary><span class="material-symbols-rounded">ios_share</span> ייבוא / ייצוא / שיתוף</summary>
          <div class="panel" id="view-share"></div>
        </details>
      </div>

      <!-- Panel containers for desktop (will be mounted into these) -->
      <section class="panel desktop-only" id="view-overview"></section>
      <section class="panel desktop-only" id="view-meta"></section>
      <section class="panel desktop-only" id="view-expenses"></section>
      <section class="panel desktop-only" id="view-journal"></section>
      <section class="panel desktop-only" id="view-map"></section>
      <section class="panel desktop-only" id="view-share"></section>
    </main>
  </div>

  <!-- ===== Modals ===== -->

  <!-- New/Edit Trip -->
  <dialog id="tripModal" class="modal">
    <form method="dialog" class="modal-card">
      <header>
        <h3 id="tripModalTitle">נסיעה חדשה</h3>
        <button class="icon-btn" value="cancel" formnovalidate>
          <span class="material-symbols-rounded">close</span>
        </button>
      </header>
      <div class="modal-body">
        <label>יעד</label>
        <input id="mdDestination" type="text" placeholder="למשל: מילאנו, איטליה" />

        <div class="row-2">
          <div>
            <label>תאריך התחלה</label>
            <input id="mdStart" type="date" />
          </div>
          <div>
            <label>תאריך סיום</label>
            <input id="mdEnd" type="date" />
          </div>
        </div>

        <label>משתתפים (מופרדים בפסיק)</label>
        <input id="mdPeople" type="text" placeholder="גל, נועה, עומר" />

        <label>סוגי טיול</label>
        <div id="mdTypes" class="type-grid">
          <!-- filled by JS -->
        </div>
      </div>
      <footer>
        <button id="tripModalDelete" class="danger left hidden" value="delete" formnovalidate>
          <span class="material-symbols-rounded">delete</span> מחק
        </button>
        <div class="spacer"></div>
        <button class="ghost" value="cancel">ביטול</button>
        <button id="tripModalSave" class="primary" value="save">שמור</button>
      </footer>
    </form>
  </dialog>

  <!-- Row menu (edit / delete) -->
  <dialog id="rowMenuModal" class="modal">
    <form method="dialog" class="modal-card">
      <header>
        <h3>אפשרויות</h3>
        <button class="icon-btn" value="cancel" formnovalidate>
          <span class="material-symbols-rounded">close</span>
        </button>
      </header>
      <div class="modal-body">
        <button id="rowEdit" class="soft" value="edit">ערוך</button>
        <button id="rowDelete" class="danger" value="delete">מחק</button>
      </div>
    </form>
  </dialog>

  <!-- Expense Modal -->
  <dialog id="expenseModal" class="modal">
    <form method="dialog" class="modal-card">
      <header>
        <h3 id="expenseTitle">הוצאה</h3>
        <button class="icon-btn" value="cancel" formnovalidate>
          <span class="material-symbols-rounded">close</span>
        </button>
      </header>
      <div class="modal-body">
        <label>תיאור</label>
        <input id="expDesc" type="text" placeholder="טיסה / מלון / אוכל" />

        <div class="row-3">
          <div>
            <label>קטגוריה</label>
            <select id="expCat">
              <option value="טיסות">טיסות</option>
              <option value="לינה">לינה</option>
              <option value="תחבורה">תחבורה</option>
              <option value="אוכל">אוכל</option>
              <option value="אטרקציות">אטרקציות</option>
              <option value="אחר">אחר</option>
            </select>
          </div>
          <div>
            <label>סכום</label>
            <input id="expAmount" type="number" step="0.01" placeholder="0.00" />
          </div>
          <div>
            <label>מטבע</label>
            <select id="expCurrency">
              <option>USD</option>
              <option>EUR</option>
              <option>ILS</option>
            </select>
          </div>
        </div>

        <label>מיקום</label>
        <div class="row-3">
          <input id="expLocationName" type="text" placeholder="חיפוש לפי שם (לא חובה)" />
          <button id="btnSelectExpLocation" class="ghost" value="pick" formnovalidate>בחר ע"ג מפה</button>
          <button id="btnUseCurrentExp" class="ghost" value="here" formnovalidate>מיקום נוכחי</button>
        </div>

        <input id="expLat" type="hidden" />
        <input id="expLng" type="hidden" />
      </div>
      <footer>
        <button id="expDelete" class="danger left hidden" value="delete" formnovalidate>
          <span class="material-symbols-rounded">delete</span> מחק
        </button>
        <div class="spacer"></div>
        <button class="ghost" value="cancel">ביטול</button>
        <button id="expSave" class="primary" value="save">שמור</button>
      </footer>
    </form>
  </dialog>

  <!-- Journal Modal -->
  <dialog id="journalModal" class="modal">
    <form method="dialog" class="modal-card">
      <header>
        <h3 id="journalTitle">רישום יומן</h3>
        <button class="icon-btn" value="cancel" formnovalidate>
          <span class="material-symbols-rounded">close</span>
        </button>
      </header>
      <div class="modal-body">
        <label>תיאור</label>
        <textarea id="jrText" rows="4" placeholder="מה עשיתי היום? קישורים יהפכו לקישורים לחיצים"></textarea>

        <label>מיקום</label>
        <div class="row-3">
          <input id="jrLocationName" type="text" placeholder="חיפוש לפי שם (לא חובה)" />
          <button id="btnSelectJrLocation" class="ghost" value="pick" formnovalidate>בחר ע"ג מפה</button>
          <button id="btnUseCurrentJr" class="ghost" value="here" formnovalidate>מיקום נוכחי</button>
        </div>

        <input id="jrLat" type="hidden" />
        <input id="jrLng" type="hidden" />
      </div>
      <footer>
        <button id="jrDelete" class="danger left hidden" value="delete" formnovalidate>
          <span class="material-symbols-rounded">delete</span> מחק
        </button>
        <div class="spacer"></div>
        <button class="ghost" value="cancel">ביטול</button>
        <button id="jrSave" class="primary" value="save">שמור</button>
      </footer>
    </form>
  </dialog>

  <!-- Map Select Modal -->
  <dialog id="mapSelectModal" class="modal large">
    <form method="dialog" class="modal-card">
      <header>
        <h3>בחר מיקום</h3>
        <button class="icon-btn" value="cancel" formnovalidate>
          <span class="material-symbols-rounded">close</span>
        </button>
      </header>
      <div class="modal-body">
        <div id="selectMap" class="map"></div>
      </div>
      <footer>
        <button class="ghost" value="cancel">ביטול</button>
        <button id="btnSavePickedLocation" class="primary" value="save">שמור מיקום</button>
      </footer>
    </form>
  </dialog>

  <!-- Unsaved changes -->
  <dialog id="unsavedChangesModal" class="modal">
    <form method="dialog" class="modal-card">
      <header>
        <h3>יש שינויים שלא נשמרו</h3>
      </header>
      <div class="modal-body">
        לשמור לפני מעבר?
      </div>
      <footer>
        <button id="unsavedCancel" class="ghost" value="cancel">בטל</button>
        <button id="unsavedDiscard" class="soft" value="discard">התעלם</button>
        <button id="unsavedSave" class="primary" value="save">שמור</button>
      </footer>
    </form>
  </dialog>

  <!-- Confirm Delete -->
  <dialog id="confirmDeleteModal" class="modal">
    <form method="dialog" class="modal-card">
      <header>
        <h3>לאשר מחיקה?</h3>
      </header>
      <div class="modal-body">
        פעולה זו אינה ניתנת לביטול.
      </div>
      <footer>
        <button class="ghost" value="cancel">ביטול</button>
        <button id="confirmDeleteYes" class="danger" value="delete">מחק</button>
      </footer>
    </form>
  </dialog>

  <!-- Toast container (Toastify will render) -->

  <!-- Vendor JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>

  <!-- Our modules -->
  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./script.js"></script>
</body>
</html>
